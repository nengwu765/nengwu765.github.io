<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>DevOpså¯è’™-å¼€å‘æµ‹è¯•ç®¡ç†ç³»ç»Ÿ</title>
    <url>/2019/09/01/Iflow2345/%E5%BC%80%E5%8F%91%E6%B5%8B%E8%AF%95%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/</url>
    <content><![CDATA[<p>è¿™ä¸ªç®—æ˜¯ä¸ªå›é¡¾å§ï¼Œè‡ªå·±å†2019å¹´è¿›å…¥Xå…¬å¸ï¼Œå‘ç°å¼€å‘æµ‹è¯•æµç¨‹è€¦åˆä¸¥é‡ï¼Œæ²¡æœ‰ç‹¬ç«‹çš„æµ‹è¯•ç¯å¢ƒç®¡ç†å¹³å°ï¼Œæ‰€ä»¥å‚ç…§è‡ªå·±çš„å‰ä¸œå®¶ï¼ˆğŸ‘‰iflowç³»ç»Ÿï¼‰å®ç°äº†ä¸€ä¸ª<code>ç®€å•</code>çš„å¼€å‘æµ‹è¯•æµç¨‹ç®¡ç†ç³»ç»Ÿï¼Œå½“æ—¶çš„<code>æ€æƒ³è¿˜å¾ˆç¨šå«©ï¼Œè§‚ç‚¹ç²—æµ…</code>ï¼ˆç®—æ˜¯è‡ªå·±DevOpså¯è’™ç¯‡å§ï¼‰ï¼Œä»…ä¾›å‚è€ƒå“ˆã€‚</p>
<span id="more"></span>
<p><strong>å¦‚æœä½ å¯¹ä»¥ä¸‹çš„å†…å®¹æ„Ÿå…´è¶£ï¼Œå¯ä»¥ä¸€èµ·æ¢è®¨äº¤æµå“¦â€¦â€¦</strong></p>
<ul>
<li>æŠ€æœ¯å¼€å‘åœ¨é¡¹ç›®ç§»äº¤æµ‹è¯•åï¼Œæ—¢å¯ä»¥â€œæ”¾é£è‡ªæˆ‘â€ã€â€œè‡ªç”±é£ç¿”â€</li>
<li>æµ‹è¯•å¦¹å­å¦‚ä½•å®ç°â€œç§äººå®šåˆ¶â€çš„æµ‹è¯•ç¯å¢ƒï¼Œå®ç°ç®€å•mockç¬¬ä¸‰æ–¹Api</li>
<li>**ç»ˆæï¼š**å¦‚ä½•è®©å¼€å‘æµ‹è¯•æ•´ä¸ªæµç¨‹è‡ªåŠ¨åŒ–</li>
</ul>
<h2 id="1-åˆæ¥ä¹åˆ°é‡åˆ°çš„é—®é¢˜"><a class="markdownIt-Anchor" href="#1-åˆæ¥ä¹åˆ°é‡åˆ°çš„é—®é¢˜"></a> 1ã€â€œåˆæ¥ä¹åˆ°â€ï¼Œé‡åˆ°çš„é—®é¢˜</h2>
<p>åˆšæ¥åˆ°å…¬å¸æ—¶ï¼Œé¡¹ç›®éƒ½æ˜¯ <strong>å°ä½œåŠç®¡ç†æ–¹å¼</strong> çš„ï¼Œé¡¹ç›®çš„æµç¨‹è§„èŒƒä¸æ˜¯å¾ˆå®Œå–„ï¼Œæœ‰äº›é¡¹ç›®è®©æˆ‘æ¥çš„æœ‰ç‚¹â€œæªæ‰‹ä¸åŠâ€å§ã€‚è¿˜æœ‰å°±æ˜¯åœ¨å¼€å‘ç§»æµ‹åï¼Œè‡ªå·±éœ€è¦è¿‡åº¦ä»‹å…¥æ•´ä¸ªæµ‹è¯•è¿‡ç¨‹ï¼Œæ— æ³•æ­£å¸¸å¼€å§‹å…¶ä»–æ–¹é¢çš„å·¥ä½œï¼š</p>
<p>æ€»ç»“ä»¥ä¸‹å§ï¼š</p>
<ul>
<li>äº§å“ç ”å‘æµç¨‹ä¸å®Œå–„</li>
<li>æµ‹è¯•å¼€å‘è¿‡åº¦è€¦åˆï¼Œæ— æ³•æœ‰æ•ˆé‡Šæ”¾ç”ŸæˆåŠ›</li>
</ul>
<p>ç»“åˆæˆ‘é‡åˆ°çš„é—®é¢˜ï¼Œæˆ‘ä¼šå’Œå¤§å®¶ä¸€èµ·æ¢è®¨è§£å†³é—®é¢˜ã€‚</p>
<h2 id="2-äº§å“ç ”å‘æµç¨‹ç®€ä»‹è¿™ä¸æ˜¯æœ¬æ–‡é‡ç‚¹"><a class="markdownIt-Anchor" href="#2-äº§å“ç ”å‘æµç¨‹ç®€ä»‹è¿™ä¸æ˜¯æœ¬æ–‡é‡ç‚¹"></a> 2ã€äº§å“ç ”å‘æµç¨‹ç®€ä»‹ã€è¿™ä¸æ˜¯æœ¬æ–‡é‡ç‚¹ã€‘</h2>
<p>å…¶å®åœ¨ç½‘ä¸Šæœ‰å¾ˆå¤šèµ„æ–™ï¼Œæ¥è¯´æ˜ä¸€ä¸ªäº’è”ç½‘äº§å“ç ”å‘çš„æµç¨‹äº†ï¼ŒåŸºæœ¬å¤§åŒå°å¼‚ã€‚</p>
<p>æˆ‘ä¸»è¦åˆ†ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ç®€å•è¯´ä¸€ä¸‹å§ï¼š</p>
<ul>
<li>éœ€æ±‚é˜¶æ®µï¼šäº§å“éœ€æ±‚è°ƒç ”ã€ä¸ºä»€ä¹ˆè¦åšï¼›åšäº†ä¹‹åä¼šå¸¦æ¥ä»€ä¹ˆå¥½å¤„ï¼›æœ€ç»ˆåœ¨æ•°æ®ä¸Šæ€ä¹ˆä½“ç°ã€‘ï¼Œæ˜ç¡®éœ€æ±‚ä¼˜å…ˆçº§</li>
<li>æ–¹æ¡ˆé˜¶æ®µï¼šäº§å“åŸå‹æ–‡æ¡£ï¼Œå„è´Ÿè´£äººéœ€æ±‚è¯„å®¡ï¼Œ<strong>ä¸€çº¿å¼€å‘&amp;æµ‹è¯•</strong> å…·ä½“æ–¹æ¡ˆè¯„å®¡ï¼Œæ’æœŸ</li>
<li>å¼€å‘é˜¶æ®µï¼šè®¾è®¡æ–¹æ¡ˆã€ç¼–ç ã€è‡ªæµ‹ã€ææµ‹</li>
<li>æµ‹è¯•é˜¶æ®µï¼šæµ‹è¯•ç”¨ä¾‹ã€çº¿ä¸‹æµ‹è¯•ã€stageæµ‹è¯•</li>
<li>ä¸Šçº¿ï¼šBetaç¯å¢ƒï¼ŒGAç¯å¢ƒ</li>
</ul>
<p>å…¶ä¸­åœ¨äº§å“çš„éœ€æ±‚å’Œæ–¹æ¡ˆé˜¶æ®µçš„æµç¨‹å®Œå–„å¯ä»¥é€šè¿‡äººä¸º <strong>å¼ºåˆ¶çº¦æŸè§„èŒƒ</strong> å¾—åˆ°æœ‰æ•ˆè§£å†³</p>
<p><img src="/2019/09/01/Iflow2345/%E5%BC%80%E5%8F%91%E6%B5%8B%E8%AF%95%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/%E4%BA%A7%E5%93%81%E7%A0%94%E5%8F%91%E6%B5%81%E7%A8%8B%E7%AE%80%E4%BB%8B.gif" alt="img"></p>
<h2 id="3-å¼€å‘æµ‹è¯•ä¸­çš„é—®é¢˜"><a class="markdownIt-Anchor" href="#3-å¼€å‘æµ‹è¯•ä¸­çš„é—®é¢˜"></a> 3ã€å¼€å‘&amp;æµ‹è¯•ä¸­çš„é—®é¢˜</h2>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//TODO å¤§å®¶éƒ½æ˜¯ç å†œï¼Œæˆ‘å°±æ‡’å¾—è¯´äº†ï¼ŒğŸ˜„</span><br></pre></td></tr></table></figure>
<h2 id="4-å¼€å‘æµ‹è¯•æµç¨‹ä½“ç³»"><a class="markdownIt-Anchor" href="#4-å¼€å‘æµ‹è¯•æµç¨‹ä½“ç³»"></a> 4ã€å¼€å‘æµ‹è¯•æµç¨‹ä½“ç³»</h2>
<h3 id="41-é—®é¢˜å¦‚ä½•è§£å†³"><a class="markdownIt-Anchor" href="#41-é—®é¢˜å¦‚ä½•è§£å†³"></a> 4.1ã€ é—®é¢˜å¦‚ä½•è§£å†³</h3>
<p>é—®é¢˜çœŸå®å­˜åœ¨ï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿæ€æ ·æ‰èƒ½ä½¿æˆ‘ä»¬çš„å·¥ä½œçš„æ›´**<code>çˆ½</code>**</p>
<p>æˆ‘çš„æ€è€ƒï¼šä¸šåŠ¡æµç¨‹åŒ– â€“&gt; æµç¨‹å·¥å…·åŒ– â€“&gt; å·¥å…·è‡ªåŠ¨åŒ–(ä¿¡æ¯åŒ–)</p>
<h3 id="42-å¼€å‘æµ‹è¯•æµç¨‹ä½“ç³»"><a class="markdownIt-Anchor" href="#42-å¼€å‘æµ‹è¯•æµç¨‹ä½“ç³»"></a> 4.2ã€ å¼€å‘æµ‹è¯•æµç¨‹ä½“ç³»</h3>
<p>å…¶å®å¾ˆå®¹æ˜“ï¼Œåœ¨ç ”å‘æµç¨‹å½“ä¸­å…¶å®å·²ç»è¯´æ˜äº†å¼€å‘æµ‹è¯•çš„ä¸€ä¸ªç®€å•çš„æµç¨‹ä½“ç³»ï¼Œå…¶ä¸»è¦å°±æ˜¯ä¸‰ä¸ªé˜¶æ®µï¼š</p>
<ul>
<li>Devé˜¶æ®µï¼šå¼€å‘è®¾è®¡æ–‡æ¡£ã€åˆ›å»ºåˆ†æ”¯ã€ç¼–ç ã€è‡ªæµ‹ã€æµ‹è¯•ç”¨ä¾‹ã€ææµ‹</li>
<li>Testé˜¶æ®µï¼šçº¿ä¸‹æµ‹è¯•ã€Stageæµ‹è¯•ã€ä»£ç å®¡æŸ¥ã€äº§å“éªŒæ”¶</li>
<li>Onlineé˜¶æ®µï¼šBetaç¯å¢ƒã€GAç¯å¢ƒ</li>
</ul>
<p>æµç¨‹åŒ–çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<p><img src="/2019/09/01/Iflow2345/%E5%BC%80%E5%8F%91%E6%B5%8B%E8%AF%95%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/%E6%B5%81%E7%A8%8B%E4%BD%93%E7%B3%BB.gif" alt="img"></p>
<h2 id="5-iflowå¼€å‘æµ‹è¯•æµç¨‹ç®¡ç†ç³»ç»Ÿ"><a class="markdownIt-Anchor" href="#5-iflowå¼€å‘æµ‹è¯•æµç¨‹ç®¡ç†ç³»ç»Ÿ"></a> 5ã€Iflowå¼€å‘æµ‹è¯•æµç¨‹ç®¡ç†ç³»ç»Ÿ</h2>
<p>åŸºäºä»¥ä¸Šçš„é—®é¢˜å’Œæ€è€ƒï¼Œä»¥åŠä»¥å¾€çš„ç»éªŒã€è¿™ä¸ªå ç»å¤§éƒ¨åˆ†ã€‘ï¼Œæˆ‘å¼€å‘ä¸€å¥—å¼€å‘æµ‹è¯•æµç¨‹ç®¡ç†ç³»ç»Ÿã€‚æ‰€æœ‰çš„æµç¨‹ã€é™¤ç‰¹å‡ºæµç¨‹ç±»å‹ï¼Œå¦‚ï¼š<code>hotfix</code>ã€‘éƒ½æ˜¯åˆ†æ­¥éª¤ä¸€æ­¥ä¸€æ­¥å¾€ä¸‹è¿›è¡Œçš„ï¼Œå¯ä»¥æµç¨‹åŒ–ç®¡ç†ã€‚</p>
<p>Iflowç³»ç»Ÿç‰¹ç‚¹ï¼š</p>
<ul>
<li>è®°å½•æ•´ä¸ªå¼€å‘æµ‹è¯•åˆ°ä¸Šçº¿çš„æ•´ä¸ªè¿‡ç¨‹</li>
<li>ä¸»å­æµç¨‹æ˜ç¡®ï¼Œä¸ä¼šæœ‰æµç¨‹äº¤å‰</li>
<li>ä¸¥æ ¼æµç¨‹åŒ–ï¼Œå½“å‰æµç¨‹ä¹‹åçš„æµç¨‹<strong>ç°è‰²</strong>ï¼Œä¸å¯ç‚¹å‡»</li>
<li>æµç¨‹åŒ–&amp;æƒé™åŒ–ï¼Œä¸¥æ ¼æŠŠæ§â€œå‡ºé”™â€é£é™©</li>
<li>æµ‹è¯•ç¯å¢ƒç»Ÿä¸€åŒ–ç®¡ç†ï¼Œæµ‹è¯•å¯è‡ªç”±å®šåˆ¶ï¼Œmockç¬¬ä¸‰æ–¹Api</li>
<li>åç»­å¯å®Œå–„ï¼ŒåšæˆCIç³»ç»Ÿ</li>
</ul>
<h3 id="51-iflow-åŸºæœ¬ç•Œé¢è¯´æ˜"><a class="markdownIt-Anchor" href="#51-iflow-åŸºæœ¬ç•Œé¢è¯´æ˜"></a> 5.1ã€IFLOW â€” åŸºæœ¬ç•Œé¢è¯´æ˜</h3>
<ul>
<li>**ä¸»æµç¨‹ï¼š**ä¸»é˜¶æ®µï¼Œåˆ›å»ºIflowã€devé˜¶æ®µã€testé˜¶æ®µã€onlineé˜¶æ®µ</li>
<li>**å­æµç¨‹ï¼š**å°±æ˜¯å½“å‰ä¸»æç«¯å¯¹åº”çš„å­é˜¶æ®µï¼Œå¦‚ä¸‹å›¾ä¸­ <strong>devé˜¶æ®µ</strong>ï¼Œå¯¹åº”çš„å¼€å‘æ–‡æ¡£é˜¶æ®µï¼Œåˆ›å»ºåˆ†æ”¯â€¦â€¦</li>
<li>**å¼€å‘åº”ç”¨ï¼š**ç›®å‰ä¸€ä¸ªQSï¼Œå¯èƒ½éœ€è¦å…³è”å¼€å‘å¤šä¸ªåº”ç”¨ï¼Œæ¯ä¸ªåº”ç”¨å¯ä»¥å•ç‹¬çš„æµç¨‹ï¼Œå¯ä»¥ç‹¬ç«‹åŒºåˆ†ï¼Œä¾¿äºä¸åŒçš„ç«¥é‹å¼€å‘</li>
</ul>
<p><img src="/2019/09/01/Iflow2345/%E5%BC%80%E5%8F%91%E6%B5%8B%E8%AF%95%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/%E5%9F%BA%E6%9C%AC%E7%95%8C%E9%9D%A2%E8%AF%B4%E6%98%8E.png" alt="img"></p>
<h3 id="52-iflow-åˆ›å»ºiflowé€‰æ‹©åº”ç”¨"><a class="markdownIt-Anchor" href="#52-iflow-åˆ›å»ºiflowé€‰æ‹©åº”ç”¨"></a> 5.2ã€IFLOW â€” åˆ›å»ºIFLOWï¼ˆé€‰æ‹©åº”ç”¨ï¼‰</h3>
<p>ç›®å‰æ ¹æ®QS-Idå»ºç«‹Iflowæµç¨‹ã€æ³¨ï¼Œç›®å‰æœªå…³è”QSç³»ç»Ÿã€‘ï¼Œå¯ä»¥é€‰æ‹©åº”ç”¨å’Œä¸åŒçš„æµç¨‹ç±»å‹åˆ›å»ºIflowæµç¨‹ã€‚</p>
<p>æµç¨‹ç±»å‹è¯´æ˜ï¼š</p>
<ul>
<li>æ­£å¸¸ï¼šéœ€è¦æŒ‰å¸¸è§„èµ°å®Œæµç¨‹</li>
<li>bugä¿®å¤/Notesting/çº¿ä¸Šç´§æ€¥bugï¼šå¯ä»¥è·³è¿‡ç‰¹å®šçš„æµç¨‹æ­¥éª¤</li>
</ul>
<p><img src="/2019/09/01/Iflow2345/%E5%BC%80%E5%8F%91%E6%B5%8B%E8%AF%95%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/%E5%88%9B%E5%BB%BA%E5%BA%94%E7%94%A8.png" alt="img"></p>
<h3 id="53-iflow-devé˜¶æ®µ"><a class="markdownIt-Anchor" href="#53-iflow-devé˜¶æ®µ"></a> 5.3ã€IFLOW â€” DEVé˜¶æ®µ</h3>
<p>ç”±å¯¹åº”<strong>å¼€å‘èµ°å®Œæ•´ä¸ªæµç¨‹</strong>ï¼Œä¸Šä¼ ä¼ æ–‡æ¡£å®¡æ ¸ï¼Œå»ºç«‹åˆ†æ”¯ï¼Œè‡ªæµ‹ï¼Œåˆ°æœ€åææµ‹ã€‚å¼€å‘èµ°å®Œæ•´ä¸ªDevé˜¶æ®µåç§»äº¤æµ‹è¯•ã€‚</p>
<p><img src="/2019/09/01/Iflow2345/%E5%BC%80%E5%8F%91%E6%B5%8B%E8%AF%95%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/dev%E9%98%B6%E6%AE%B5.gif" alt="img"></p>
<h3 id="54-iflow-testé˜¶æ®µ"><a class="markdownIt-Anchor" href="#54-iflow-testé˜¶æ®µ"></a> 5.4ã€IFLOW â€” TESTé˜¶æ®µ</h3>
<p>ç”±å¯¹åº”<strong>æµ‹è¯•èµ°å®Œæ•´ä¸ªæµç¨‹</strong></p>
<blockquote>
<p>é¦–å…ˆæµ‹è¯•å¯ä»¥åœ¨å·¦ä¾§èœå•æ ã€iflowæµç¨‹åˆ—è¡¨ã€‘ï¼Œæ£€ç´¢å¯¹åº”QS-IDï¼Œå³å¯è¿›å…¥å¯¹åº”çš„æµç¨‹æµ‹è¯•ï¼Œä»¥åŠæŸ¥çœ‹devé˜¶æ®µçš„apiæ–‡æ¡£å’Œå¼€å‘æ–‡æ¡£ã€‚</p>
</blockquote>
<blockquote>
<p>å…¶æ¬¡è¿›å…¥devé˜¶æ®µå®Œæˆç›¸åº”é˜¶æ®µçš„æµ‹è¯•ï¼Œå…¶ä¸­æµ‹è¯•ç¯å¢ƒæ”¯æŒä»¥ä¸‹çš„åŠŸèƒ½ï¼š</p>
</blockquote>
<ul>
<li>**é‡Šæ”¾åˆ†æ”¯ï¼š**é‡Šæ”¾å½“å‰çš„æµ‹è¯•ç¯å¢ƒç»‘å®š</li>
<li>**åˆ‡æ¢/æ›´æ–°åˆ†æ”¯ï¼š**å°†å½“å‰iflowæµç¨‹å¯¹åº”çš„åˆ†æ”¯ï¼Œåˆ‡æ¢è‡³å½“å‰çš„æµ‹è¯•ç¯å¢ƒ</li>
<li>**æ›´æ–°devé…ç½®æ–‡ä»¶ï¼š**åŸºäºç›®å‰ç¯å¢ƒå­˜åœ¨çš„åˆ†æ”¯ä»£ç ï¼ŒåŒæ­¥copyæ›´æ–°devé…ç½®æ–‡ä»¶ï¼Œæ³¨æ„ï¼šæ›´æ–°åï¼ŒåŸæœ‰çš„å®šåˆ¶é…ç½®å°†è¢«è¦†ç›–ã€‚</li>
<li>**é…ç½®æ–‡ä»¶ä¿®æ”¹ï¼š**æ›´æ”¹/å®šåˆ¶å½“å‰æµ‹è¯•ç¯å¢ƒçš„é…ç½®æ–‡ä»¶</li>
<li>**æ¨¡æ‹ŸAPiã€mockç¬¬ä¸‰æ–¹apiæ•°æ®ã€‘ï¼š**å¯ä»¥æ¨¡æ‹Ÿç¬¬ä¸‰æ–¹çš„apiè¿”å›æ•°æ®ï¼Œè®¾ç½®è¶…æ—¶ï¼Œã€ä½¿ç”¨å‰ï¼Œæ³¨æ„ç»‘å®šä¸‹å¯¹åº”æ¨¡æ‹Ÿapiçš„åŸŸåIPï¼Œä¸åŒçš„ç¯å¢ƒè¿™ä¸ªåŸŸåå’ŒIPä¸åŒã€‘ã€‚</li>
</ul>
<p><img src="/2019/09/01/Iflow2345/%E5%BC%80%E5%8F%91%E6%B5%8B%E8%AF%95%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/test%E9%98%B6%E6%AE%B5.gif" alt="img"></p>
<h3 id="55-iflow-onlineé˜¶æ®µ"><a class="markdownIt-Anchor" href="#55-iflow-onlineé˜¶æ®µ"></a> 5.5ã€IFLOW â€” ONLINEé˜¶æ®µ</h3>
<p>å³ä¸Šçº¿è‡³betaç¯å¢ƒå’ŒGAç¯å¢ƒï¼Œæ˜¾ç¤ºä½†å‰ç‰ˆæœ¬åˆ—è¡¨ï¼Œæ”¯æŒä¸€é”®å›é€€åŠŸèƒ½ã€ç›®å‰åªæ˜¯ä¸€ä¸ªç©ºæ¶å­ã€‘ã€‚</p>
<p><img src="/2019/09/01/Iflow2345/%E5%BC%80%E5%8F%91%E6%B5%8B%E8%AF%95%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/online%E9%98%B6%E6%AE%B5.gif" alt="img"></p>
<h2 id="6-æ€»ç»“"><a class="markdownIt-Anchor" href="#6-æ€»ç»“"></a> 6ã€æ€»ç»“</h2>
<p>æ•´ä½“æ¥è¯´IFLOWå¼€å‘æµ‹è¯•æµç¨‹ç®¡ç†ç³»ç»Ÿåªæ˜¯ä¸€ä¸ª<strong>æµç¨‹æ¡†æ¶æˆ–è€…å¤–å£³</strong>ï¼Œåç»­ç›¸å…³çš„åŠŸèƒ½çš„æ¨¡å—éƒ½å¯ä»¥è¿›è¡Œé›†æˆï¼Œå°†å…¶å½¢æˆä¸€å¥—å®Œå–„çš„æµç¨‹ç®¡ç†ç³»ç»Ÿï¼ˆæ•´ä½“é¡µé¢åŠŸèƒ½å¯èƒ½ä¼šæ¯”è¾ƒç®€é™‹ï¼Œå½“æ—¶èŠ±è´¹ä¸€ä¸ªå¤šæœˆçš„é—²ä½™æ—¶é—´å†™çš„ğŸ˜€ï¼‰ã€‚</p>
<p><strong>å¯é›†æˆåŠŸèƒ½ï¼š</strong></p>
<ul>
<li>**æ–‡æ¡£ç³»ç»Ÿï¼š**apiæ–‡æ¡£ã€WikiçŸ¥è¯†åº“</li>
<li>**æµ‹è¯•ç”¨ä¾‹ç³»ç»Ÿï¼š**æµ‹è¯•ç¼–å†™ç”¨ä¾‹ï¼Œå¼€å‘å¯ä»¥å®¡æ ¸è¿‡æµ‹è¯•ç”¨ä¾‹ç­‰</li>
<li>**è‡ªåŠ¨åŒ–æµ‹è¯•ç³»ç»Ÿï¼š**æµ‹è¯•è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬</li>
<li>**ä»£ç ç®¡ç†å¹³å°ï¼š**å¯ä»¥ç›´æ¥æ£€æµ‹ä»£ç è´¨é‡ï¼Œç»™ä»£ç è¯„åˆ†ç­‰ï¼Œæ¯”å¦‚ <a href="http://bbs.2345.net/d/169-sonarqube/3"><strong>sonarQubeï¼Œå¯ç‚¹å‡»æ­¤æŸ¥çœ‹</strong></a></li>
<li>**æ‰“åŒ…æ„å»ºå·¥å…·ï¼š**æ¯”å¦‚jekinsï¼ˆPHPä½ æ‡‚çš„ï¼Œæœ¨æœ‰æ„å»ºå“¦ğŸ˜‚ï¼‰</li>
<li><strong>CIå¯æŒç»­é›†æˆ</strong></li>
<li><strong>å‘å¸ƒç³»ç»Ÿ</strong></li>
<li>â€¦â€¦</li>
</ul>
]]></content>
      <categories>
        <category>Iflow</category>
      </categories>
      <tags>
        <tag>Iflow</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»£ç æ‰«æ(ä¸€)-å·¥å…·é€‰å‹</title>
    <url>/2021/05/27/SonarQube/%E4%BB%A3%E7%A0%81%E6%89%AB%E6%8F%8F(%E4%B8%80)-%E5%B7%A5%E5%85%B7%E9%80%89%E5%9E%8B/</url>
    <content><![CDATA[<p>DevOpså¿…ä¸å¯å°‘çš„ä¸€ç¯å°±æ˜¯ä»£ç æ‰«æäº†ï¼Œè¿™é‡Œé¢åŒ…å«äº†ç¼–ç è§„èŒƒã€ä»£ç ç¼ºé™·ã€æ€§èƒ½ã€æ¼æ´çš„æ£€æµ‹ã€‚ç›®å‰ä¹Ÿä¼šæœ‰å¾ˆå¤šçš„å¼€æºé™æ€ä»£ç æ‰«æå·¥å…·ï¼Œå¦‚ï¼šSonarQubeã€Inferã€PMDã€FindBugsã€CheckStyleã€‚é’ˆå¯¹æ­¤åšäº†ç®€å•çš„æ”¶é›†å¯¹æ¯”ï¼Œå„ä½å¯ä»¥æ ¹æ®è‡ªèº«çš„éœ€æ±‚è¿›è¡Œå‚è€ƒã€‚</p>
<span id="more"></span>
<h2 id="å·¥å…·é€‰å‹è°ƒç ”"><a class="markdownIt-Anchor" href="#å·¥å…·é€‰å‹è°ƒç ”"></a> å·¥å…·é€‰å‹è°ƒç ”</h2>
<h3 id="å·¥å…·å¯¹æ¯”è¯´æ˜"><a class="markdownIt-Anchor" href="#å·¥å…·å¯¹æ¯”è¯´æ˜"></a> å·¥å…·å¯¹æ¯”è¯´æ˜</h3>
<p>ç›®å‰æ¯”è¾ƒæµè¡Œçš„å¼€æºçš„é™æ€ä»£ç æ‰«æå·¥å…·ï¼šSonarQubeã€Inferã€PMDã€FindBugsã€CheckStyleã€‚å› ä¸ºåç»­ä¼šæœ‰æµç¨‹å®šåˆ¶åŒ–ç­‰éœ€æ±‚ï¼Œæš‚ä¸è€ƒè™‘å•†ä¸šåŒ–çš„è½¯ä»¶ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left">äº§å“</th>
<th style="text-align:center">å®šä½</th>
<th style="text-align:left">OpenApi</th>
<th style="text-align:left">Webé¡¹ç›®å‹å¥½</th>
<th style="text-align:left">æ”¯æŒä»£ç è´¨é‡æ£€æŸ¥</th>
<th style="text-align:left">æ”¯æŒè¯­è¨€</th>
<th style="text-align:left">å¯æ‰©å±•æ€§/æ’ä»¶æ”¯æŒ</th>
<th style="text-align:left">æ˜¯å¦ä¾µå…¥é¡¹ç›®</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">SonarQube</td>
<td style="text-align:center">ä»£ç è´¨é‡å¹³å° <br>é€šè¿‡æ’ä»¶çš„<br>æ–¹å¼æä¾›å¯¹å„ä¸ª<br>è¯­è¨€è¿›è¡Œæ”¯æŒï¼Œ<br>å¯ä»¥å’Œ Checkstyleã€PMDã€Simian <br>ç­‰å·¥å…·è¿›è¡Œé›†æˆ</td>
<td style="text-align:left">æ”¯æŒ</td>
<td style="text-align:left">æ˜¯</td>
<td style="text-align:left">æ”¯æŒ</td>
<td style="text-align:left">å¸¸è§è¯­è¨€éƒ½æ”¯æŒ</td>
<td style="text-align:left">é«˜</td>
<td style="text-align:left">å¦</td>
</tr>
<tr>
<td style="text-align:left">Infer</td>
<td style="text-align:center">ä»£ç åˆ†æ</td>
<td style="text-align:left">ä¸æ”¯æŒ</td>
<td style="text-align:left">å¦ï¼ˆç§»åŠ¨ç«¯å‹å¥½ï¼‰</td>
<td style="text-align:left">æ”¯æŒ</td>
<td style="text-align:left">Android/java</td>
<td style="text-align:left">ä¸­</td>
<td style="text-align:left">æ˜¯</td>
</tr>
<tr>
<td style="text-align:left">PMD</td>
<td style="text-align:center">ä»£ç åˆ†æ</td>
<td style="text-align:left">ä¸æ”¯æŒ</td>
<td style="text-align:left">æ˜¯</td>
<td style="text-align:left">æ”¯æŒ</td>
<td style="text-align:left">java</td>
<td style="text-align:left">é«˜</td>
<td style="text-align:left">å¦</td>
</tr>
<tr>
<td style="text-align:left">FindBugs</td>
<td style="text-align:center">å­—èŠ‚ç åˆ†æï¼Œä¾§é‡Bugæ£€æµ‹</td>
<td style="text-align:left">ä¸æ”¯æŒ</td>
<td style="text-align:left"></td>
<td style="text-align:left">æ”¯æŒ</td>
<td style="text-align:left">java</td>
<td style="text-align:left">ä½</td>
<td style="text-align:left">æ˜¯</td>
</tr>
<tr>
<td style="text-align:left">CheckStyle</td>
<td style="text-align:center">è¯­æ³•å±‚é¢åˆ†æ</td>
<td style="text-align:left">ä¸æ”¯æŒ</td>
<td style="text-align:left"></td>
<td style="text-align:left">æ”¯æŒ</td>
<td style="text-align:left">java</td>
<td style="text-align:left">ä½</td>
<td style="text-align:left">æ˜¯</td>
</tr>
</tbody>
</table>
<h3 id="é€‰å‹"><a class="markdownIt-Anchor" href="#é€‰å‹"></a> é€‰å‹</h3>
<p>åŸºäºä¸Šè¿°ï¼Œ<strong>é€‰å‹SonarQubeä½œä¸ºä»£ç æ‰«æå·¥å…·</strong>ï¼ŒSonarQube ä¹Ÿæ˜¯æ˜¯ä¸€æ¬¾ç›®å‰æ¯”è¾ƒæµè¡Œçš„å·¥å…·ï¼Œå›½å†…å¾ˆå¤šäº’è”ç½‘å…¬å¸éƒ½é€‰æ‹©ç”¨å®ƒæ¥æ­å»ºé™æ€æ£€æŸ¥çš„å¹³å°ã€‚</p>
<p>SonarQubeä»‹ç»: <a href="https://www.sonarqube.org/">å®˜ç½‘</a></p>
<h2 id="å®æ–½è®¡åˆ’"><a class="markdownIt-Anchor" href="#å®æ–½è®¡åˆ’"></a> å®æ–½è®¡åˆ’</h2>
<ul>
<li>SonarQubeçš„éƒ¨ç½²ä½¿ç”¨è°ƒç ”</li>
<li>ä»£ç æ£€æµ‹é›†æˆæ–¹æ¡ˆï¼Œï¼ˆJenkinsã€gitlab CIã€ä»£ç æ£€æµ‹æ—¶æœºç­‰ï¼‰</li>
<li>è€ƒè™‘ä»£ç è´¨é‡å¹³å°ç®¡ç†ï¼ˆåŸç”Ÿå¹³å°ç•Œé¢ä¸å‹å¥½ã€åŒæ—¶å±•ç¤ºç»´åº¦æ— æ³•åšåˆ°åº”ç”¨ç»´åº¦ï¼‰</li>
</ul>
<h2 id="å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#å‚è€ƒèµ„æ–™"></a> <strong>å‚è€ƒèµ„æ–™</strong></h2>
<table>
<thead>
<tr>
<th style="text-align:left"></th>
<th style="text-align:left">èµ„æ–™</th>
<th style="text-align:left">æ¦‚è¿°</th>
<th style="text-align:left">å‚è€ƒä»·å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left"><a href="https://testerhome.com/articles/24210">é…·å®¶ä¹è´¨é‡æ•ˆèƒ½ ä»£ç åº¦é‡å¹³å°</a></td>
<td style="text-align:left">å¼•å…¥ä½¿ç”¨ SQALE ä»£ç è´¨é‡è¯„ä¼°æ¨¡å‹çš„ SonarQube è¿›è¡Œä»£ç é™æ€æ‰«æï¼Œè¾…ä»¥ Cobra çš„è¿›è¡Œä»£ç å®¡è®¡ï¼ŒSynk è¿›è¡Œä¸‰æ–¹åŒ…æ¼æ´æ‰«æï¼Œå½¢æˆä¸€å¥—å®Œæ•´çš„ä»£ç åº¦é‡å·¥å…·é“¾</td>
<td style="text-align:left"><strong>é«˜</strong><br>æ•´åˆå¹³å°é¡µé¢å‚è€ƒ</td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td style="text-align:left"><a href="https://mp.weixin.qq.com/s/d9RzCFkYrW27m1_LkeA2rw">ç³»åˆ— | 58é›†å›¢ç™½ç›’ä»£ç å®¡è®¡ç³»ç»Ÿå»ºè®¾å®è·µ1ï¼šæŠ€æœ¯é€‰å‹</a></td>
<td style="text-align:left">å¯¹æ¯”äº†å¸¸è§çš„çš„å¼€æºæ–¹æ¡ˆå’Œå•†ä¸šæ–¹æ¡ˆï¼ŒåŒæ—¶æ¶‰åŠä»‹ç» SDL ç›¸å…³æ£€æµ‹çŸ¥è¯†</td>
<td style="text-align:left"><strong>é«˜</strong><br>é€‰å‹å¯¹æ¯”æ•°æ®å‚è€ƒ</td>
</tr>
</tbody>
</table>
]]></content>
      <categories>
        <category>SonarQube</category>
      </categories>
      <tags>
        <tag>SonarQube</tag>
        <tag>ä»£ç æ‰«æ</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»£ç æ‰«æ(ä¸‰)-Sonar+Jenkins+Gitlabé›†æˆ</title>
    <url>/2021/05/31/SonarQube/%E4%BB%A3%E7%A0%81%E6%89%AB%E6%8F%8F(%E4%B8%89)-Sonar+Jenkins+Gitlab/</url>
    <content><![CDATA[<p>ç›®å‰æˆ‘ä»¬ä½¿ç”¨CIå·¥å…·ä¸»è¦æ˜¯Jenkinsï¼Œæ‰€ä»¥æ­¤ç›¸äº’é€‰æ‹©äº†jenkinsè¿›è¡Œé›†æˆã€‚æ ¹æ®å®é™…æƒ…å†µï¼Œä¹Ÿå¯é€‰æ‹©GitlabCIç­‰å·¥å…·ã€‚</p>
<p>å®æ–½ä»£ç æ£€æµ‹ï¼ŒGitlab ä»£ç å˜æ›´ï¼ˆPush/Mergeï¼‰ï¼Œè§¦å‘Jenkins Jobæ‰§è¡ŒSonarScanneræ‰«æä»£ç ï¼ŒSonarServeré€šè¿‡Gitlabæ’ä»¶ï¼Œå°†ä»£ç æ‰«æå®Œçš„ç»“æœå›å†™è‡³Gitlabï¼ŒGitLabå³å¯æŸ¥çœ‹åˆ°å¯¹åº”Sonaræ£€æµ‹çš„ç»“æœä»£ç æ³¨é‡Šï¼Œæ–¹ä¾¿å¼€å‘äººå‘˜ä»£ç æ’æŸ¥</p>
<span id="more"></span>
<h2 id="å®ç°ç›®çš„"><a class="markdownIt-Anchor" href="#å®ç°ç›®çš„"></a> å®ç°ç›®çš„</h2>
<ul>
<li>1ã€ç ”å‘è¿‡ç¨‹ï¼ŒJenkinsåœ¨æ„å»ºè¿‡ç¨‹ï¼ŒåŠ å…¥SonarQubeçš„ä»£ç è´¨é‡é—¨ï¼Œæ£€æµ‹æœ¬æ¬¡æ„å»ºå¢é‡ä»£ç è´¨é‡</li>
<li>2ã€å®šæœŸçš„å…¨é‡ä»£ç è´¨é‡æ‰«æï¼Œåœ¨æ¯å‘¨å®šæœŸå¯¹å…¬å¸æ‰€æœ‰ä»£ç è¿›è¡Œå…¨é‡æ‰«æï¼Œäº§å‡ºä»£ç è´¨é‡æŠ¥å‘Š</li>
</ul>
<h2 id="é›†æˆæ’ä»¶é…ç½®"><a class="markdownIt-Anchor" href="#é›†æˆæ’ä»¶é…ç½®"></a> é›†æˆæ’ä»¶é…ç½®</h2>
<h3 id="1-jenkinsæ’ä»¶é…ç½®"><a class="markdownIt-Anchor" href="#1-jenkinsæ’ä»¶é…ç½®"></a> 1ã€Jenkinsæ’ä»¶&amp;é…ç½®</h3>
<p><strong>æ’ä»¶ï¼š</strong></p>
<ul>
<li>SonarQubeScannerForJenkins</li>
</ul>
<p><strong>é…ç½®ï¼š</strong></p>
<ul>
<li>SonarServeré…ç½®ï¼šManage Jenkins â€“ &gt; Configure System â€“ &gt; SonarQube servers<br>
éœ€è¦SonarQubeåŸºäºé«˜æƒé™è´¦å·ç”Ÿæˆçš„ æˆæƒtoken ï¼ˆSonarQubeï¼šAdministration â€“ &gt; Security â€“ &gt; Usersï¼‰</li>
<li>SonarScanneré…ç½®ï¼šManage Jenkins â€“ &gt; Global Tool Configuration â€“ &gt; SonarQube Scanner<br>
å¤‡æ³¨ï¼š<strong>è¿™é‡Œå®‰è£…å¤šä¸ªSonarQube Scannerï¼Œä¸ºå¤šé¡¹ç›®å¹¶è¡Œä»£ç æ‰«æåšå‡†å¤‡</strong></li>
</ul>
<h3 id="2-sonarqubeé…ç½®"><a class="markdownIt-Anchor" href="#2-sonarqubeé…ç½®"></a> 2ã€SonarQubeé…ç½®</h3>
<p><strong>æ’ä»¶ï¼š</strong></p>
<p>å®ç°gitlabæ‰“é€šï¼Œ<strong>åŒæ—¶å®ç°gitlab authæˆæƒç™»é™†</strong>ã€‚</p>
<ul>
<li>sonar-gitlab-pluginï¼š<a href="https://github.com/javamachr/sonar-gitlab-plugin">https://github.com/javamachr/sonar-gitlab-plugin</a></li>
<li>**sonar-auth-gitlab-pluginï¼š**<a href="https://github.com/gabrie-allaigre/sonar-auth-gitlab-plugin">https://github.com/gabrie-allaigre/sonar-auth-gitlab-plugin</a></li>
</ul>
<p>**Sonar Serverbase Urlè®¾ç½®ï¼š**Administration &gt; Configuration &gt; General&gt; Server base URL</p>
<p><strong>Webhooké…ç½®ï¼šï¼ˆå®æ“ï¼Œä¸é…ç½®ï¼ŒJEnkinsåœ¨è·å–è´¨é‡é—¨ç»“æœæ—¶ä¼šæ— é™ç­‰å¾…ï¼‰</strong></p>
<p>Administration &gt; Configuration &gt; Webhooks. The URL should point to your Jenkins serverï¼š <code>http://&#123;JENKINS_HOST&#125;/sonarqube-webhook/</code></p>
<p>å…·ä½“è¯´æ˜ï¼šå‚è€ƒJenkinså®˜æ–¹æ–‡æ¡£è¯´æ˜ï¼ˆ<a href="https://www.jenkins.io/doc/pipeline/steps/sonar/#waitforqualitygate-wait-for-sonarqube-analysis-to-be-completed-and-return-quality-gate-status">Configure a webhook in your SonarQube server pointing</a> â€¦ ï¼‰</p>
<p><strong>Gitlabæˆæƒç™»é™†ï¼š</strong></p>
<p>Administration &gt; Configuration &gt; GitLab &gt; Authentication ï¼šè®¾ç½®å¯¹åº”çš„ Application ID + Secret</p>
<p>(è®¾ç½®å‚æ•°è¯´æ˜ï¼Œå‚è€ƒå¯¹åº”çš„æ’ä»¶è¯´æ˜ï¼š<a href="https://github.com/gabrie-allaigre/sonar-auth-gitlab-plugin">sonar-auth-gitlab-plugin</a>)</p>
<p><strong>Gitlab Reportingé…ç½®ï¼š</strong></p>
<ul>
<li>
<p>ä½œç”¨ï¼šå¯ä»¥å°†æ£€æµ‹ç»“æœæŠ¥å‘Šå·²commentçš„å½¢å¼å›å†™è‡³Gitlabçš„Commitä¸­ï¼ˆæ³¨ï¼šç›®å‰ç‰ˆæœ¬ä¸æ”¯æŒinline comment in commitï¼Œç°åœ¨åªæœ‰global commentï¼Œå…·ä½“çœ‹é™„å±é—®é¢˜è®°å½•è¯´æ˜ï¼‰</p>
</li>
<li>
<p>é…ç½®ï¼šAdministration &gt; Configuration &gt; GitLab &gt; Reporting</p>
</li>
<li>
<p>å‚æ•°ï¼šæ‰«ææ—¶éœ€è¦é…ç½®å‚æ•°ï¼šsonar.gitlab.project_id</p>
</li>
</ul>
<p>è¯´æ˜ï¼šè¿™ä¸ªå¯ä»¥æ ¹æ®å®é™…éœ€æ±‚é…ç½®è¯´æ˜ï¼Œæ­¤å¤„å¯æ ¹æ®éœ€æ±‚é…ç½®å°†æ£€æµ‹çš„ç»“æœæ˜¯å¦ä»¥commentå›å†™ã€‚æ­¤å¤„æš‚æ—¶ä¸é…ç½®ã€‚</p>
<h3 id="3-gitlabé…ç½®"><a class="markdownIt-Anchor" href="#3-gitlabé…ç½®"></a> 3ã€Gitlabé…ç½®</h3>
<p><strong>æˆæƒç™»é™†è®¾ç½®ï¼š</strong><br>
Admin Settings -&gt; Applicationï¼šè®¾ç½®å¯¹åº”çš„å›è°ƒï¼šhttps://<your sonar domain>/oauth2/callback/gitlab (å¤‡æ³¨ï¼šsonarçš„domainä¸å¯ä¸ºIP+Portå½¢å¼ï¼Œç»æµ‹è¯•httpç›®å‰ä¹Ÿæ˜¯æ”¯æŒ)</your></p>
<h2 id="é—®é¢˜è®°å½•"><a class="markdownIt-Anchor" href="#é—®é¢˜è®°å½•"></a> é—®é¢˜è®°å½•</h2>
<ul>
<li>SonarCloud + GitHub + Pull Request Analysis = No Inline Commentsï¼š<a href="https://community.sonarsource.com/t/sonarcloud-github-pull-request-analysis-no-inline-comments/7371/2">https://community.sonarsource.com/t/sonarcloud-github-pull-request-analysis-no-inline-comments/7371/2</a><br>
ç›®å‰æœ€åæ”¯æŒçš„ç‰ˆæœ¬ï¼šsonarqube v7.6</li>
<li>æ–°æ‰«æé¡¹ç›®ï¼ˆæ–°sonar project keyï¼‰ No branches currently exist in this project. Please scan the main branch without passing any branch parameters<br>
æ³¨ï¼šæ–°é¡¹ç›®å¿…é¡»å…ˆæ‰«æ masterï¼ˆç¨³å®šï¼‰åˆ†æ”¯ï¼Œæ‰å¯ä»¥è¿›è¡Œå…¶ä»–åˆ†æ”¯çš„æ‰«æ</li>
<li>ä¸å»ºè®®å†™å…¥sonar.languageæ‰«æå‚æ•°ï¼š <a href="https://community.sonarsource.com/t/what-is-the-alternative-to-the-sonar-language-property-in-the-current-version-of-sonarqube/3993">https://community.sonarsource.com/t/what-is-the-alternative-to-the-sonar-language-property-in-the-current-version-of-sonarqube/3993</a></li>
<li>SonarQubeæ’ä»¶çŸ©é˜µï¼ˆå¯æŸ¥çœ‹ç›¸å…³äº§æ£€å…¼å®¹æƒ…å†µï¼‰ï¼š<a href="https://docs.sonarqube.org/latest/instance-administration/plugin-version-matrix/">https://docs.sonarqube.org/latest/instance-administration/plugin-version-matrix/</a></li>
</ul>
<h2 id="å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#å‚è€ƒèµ„æ–™"></a> å‚è€ƒèµ„æ–™</h2>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//TODO</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>SonarQube</category>
      </categories>
      <tags>
        <tag>SonarQube</tag>
        <tag>ä»£ç æ‰«æ</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»£ç æ‰«æ(äºŒ)-SonarQubeå®‰è£…</title>
    <url>/2021/05/31/SonarQube/%E4%BB%A3%E7%A0%81%E6%89%AB%E6%8F%8F(%E4%BA%8C)-SonarQube%E5%AE%89%E8%A3%85/</url>
    <content><![CDATA[<p>SonarQubeçš„å®‰è£…ä¼šç»™äºˆç‰ˆæœ¬æœ‰äº›å·®å¼‚ï¼Œå»ºè®®æ ¹æ®ä½ é€‰æ‹©çš„ç‰ˆæœ¬ç»“åˆå®˜æ–¹çš„æ–‡æ¡£è¿›è¡Œå®‰è£…ï¼Œä¸­é—´é‡åˆ°é—®é¢˜å†è‡ªè¡ŒGoogleä¸€ä¸‹å•¦ã€‚æœ¬æ–‡ä¸»è¦æ˜¯è®²è§£ä¸€ä¸‹ç‰ˆæœ¬çš„å®‰è£…ï¼šSonarQubeï¼š7.9 LTS +PostgreSQL 10</p>
<span id="more"></span>
<h2 id="ç‰ˆæœ¬é€‰æ‹©"><a class="markdownIt-Anchor" href="#ç‰ˆæœ¬é€‰æ‹©"></a> ç‰ˆæœ¬é€‰æ‹©</h2>
<p>ä¸åŒçš„ç‰ˆæœ¬å¯¹åº”çš„æ’ä»¶é€‰æ‹©å’Œæ•°æ®åº“æ”¯æŒä¸åŒï¼ŒåŒæ—¶éœ€è¦è€ƒè™‘ç‰ˆæœ¬çš„ç¨³å®šæ€§ã€‚è€ƒè™‘ç¨³å®šæ€§ï¼Œé¿å…å‡ºç°é—®é¢˜æ— æ³•è·Ÿè¿›å¤„ç†è§£å†³ï¼Œç”Ÿäº§ç¯å¢ƒä¸è€ƒè™‘æœ€æ–°ç‰ˆæœ¬ã€‚</p>
<p>SonarQubeï¼š7.9 LTS</p>
<p>SonarQube v7.9 çš„å‰ç½®ä¾èµ–è¯´æ˜ï¼ˆ<a href="https://docs.sonarqube.org/7.9/requirements/requirements/%EF%BC%89">https://docs.sonarqube.org/7.9/requirements/requirements/ï¼‰</a></p>
<ul>
<li>æ•°æ®åº“ï¼šPostgreSQL 10</li>
<li>Java JDKï¼šOpenJDK 11</li>
</ul>
<h2 id="å®‰è£…è¯´æ˜"><a class="markdownIt-Anchor" href="#å®‰è£…è¯´æ˜"></a> å®‰è£…è¯´æ˜</h2>
<h3 id="1-openjdk-11å®‰è£…"><a class="markdownIt-Anchor" href="#1-openjdk-11å®‰è£…"></a> 1ã€OpenJDK 11å®‰è£…</h3>
<p>å®˜æ–¹å®‰è£…å¼•å¯¼ï¼š<a href="https://openjdk.java.net/install/">https://openjdk.java.net/install/</a></p>
<p>å®‰è£…åŒ…ï¼ˆLinux/x64ï¼‰ï¼šï¼ˆ<a href="https://download.java.net/openjdk/jdk11/ri/openjdk-11+28_linux-x64_bin.tar.gz">å®˜æ–¹ä¸‹è½½</a> ï¼‰</p>
<p><strong>è§£å‹ç¼©</strong></p>
<p>&gt; tar -zxvf openjdk-11+28_linux-x64_bin.tar.gz</p>
<p><strong>é…ç½®ç¯å¢ƒå˜é‡</strong></p>
<p>&gt; æœ«å°¾å¢åŠ å¦‚ä¸‹å†…å®¹(æ ¹æ®è‡ªå·±jdkç›®å½•ä¿®æ”¹)ï¼š<br>
&gt; export JAVA_HOME=/usr/local/jdk-11<br>
&gt; export CLASSPATH=<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>J</mi><mi>A</mi><mi>V</mi><msub><mi>A</mi><mi>H</mi></msub><mi>O</mi><mi>M</mi><mi>E</mi><mi mathvariant="normal">/</mi><mi>l</mi><mi>i</mi><mi>b</mi><mo>:</mo></mrow><annotation encoding="application/x-tex">JAVA_HOME/lib:</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.09618em;">J</span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.08125em;">H</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord">/</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">i</span><span class="mord mathdefault">b</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span></span></span>CLASSPATH<br>
&gt; export PATH=<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>J</mi><mi>A</mi><mi>V</mi><msub><mi>A</mi><mi>H</mi></msub><mi>O</mi><mi>M</mi><mi>E</mi><mi mathvariant="normal">/</mi><mi>b</mi><mi>i</mi><mi>n</mi><mo>:</mo></mrow><annotation encoding="application/x-tex">JAVA_HOME/bin:</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.09618em;">J</span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.08125em;">H</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord">/</span><span class="mord mathdefault">b</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span></span></span>PATH</p>
<p><strong>éªŒè¯</strong></p>
<p>&gt; java -version</p>
<h3 id="2-postgresql-10å®‰è£…"><a class="markdownIt-Anchor" href="#2-postgresql-10å®‰è£…"></a> 2ã€PostgreSQL 10å®‰è£…</h3>
<p>å®˜æ–¹çš„å®‰è£…å¼•å¯¼ï¼š<a href="https://www.postgresql.org/download/linux/redhat/">https://www.postgresql.org/download/linux/redhat/</a></p>
<ul>
<li>Select versionï¼š10</li>
<li>Select platformï¼šCentOS 7</li>
<li>Select architecture: x86_64</li>
</ul>
<p>æ‰§è¡Œå®‰è£…è„šæœ¬åŠåˆå§‹åŒ–å¯åŠ¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…repoæº</span></span><br><span class="line">sudo yum install -y https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm</span><br><span class="line"> </span><br><span class="line"><span class="comment"># å®‰è£…æœåŠ¡ç«¯</span></span><br><span class="line">sudo yum install -y postgresql10-server</span><br><span class="line"> </span><br><span class="line"><span class="comment"># PGsqlè¿›è¡Œåˆå§‹åŒ–</span></span><br><span class="line">sudo /usr/pgsql-10/bin/postgresql-10-setup initdb</span><br><span class="line"> </span><br><span class="line"><span class="comment"># åŠ å…¥å¼€æœºå¯åŠ¨</span></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> postgresql-10</span><br><span class="line"> </span><br><span class="line"><span class="comment"># å¯åŠ¨PGsql</span></span><br><span class="line">stl start postgresql-10</span><br><span class="line"> </span><br><span class="line"><span class="comment"># æŸ¥çœ‹æœåŠ¡çŠ¶æ€</span></span><br><span class="line">systemctl status postgresql-10.service</span><br></pre></td></tr></table></figure>
<p>åˆå§‹åŒ–SonarQubeä½¿ç”¨çš„æ•°æ®</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ‡æ¢åˆ°postgresç”¨æˆ·</span></span><br><span class="line">su - postgres</span><br><span class="line"> </span><br><span class="line"><span class="comment"># è¿æ¥åˆ°æ•°æ®åº“</span></span><br><span class="line">psql</span><br><span class="line"> </span><br><span class="line"><span class="comment"># åˆ›å»ºæ•°æ®åº“</span></span><br><span class="line">CREATE DATABASE sonarqube;</span><br><span class="line"> </span><br><span class="line"><span class="comment"># åˆ›å»ºç”¨æˆ·</span></span><br><span class="line">CREATE USER sonarqube WITH PASSWORD <span class="string">&#x27;xxxxx&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment"># è®¾ç½®æƒé™</span></span><br><span class="line">GRANT ALL PRIVILEGES ON DATABASE sonarqube TO sonarqube;</span><br><span class="line"> </span><br><span class="line"><span class="comment"># åˆ›å»ºæˆæƒï¼ˆå¿…é¡»ï¼‰</span></span><br><span class="line">ALTER DATABASE sonarqube owner to sonarqube;</span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹pgæ•°æ®çš„pg_hba.confï¼ˆ<a href="http://www.postgres.cn/docs/10/auth-pg-hba-conf.html"><code>pg_hba.conf</code>æ–‡ä»¶è¯´æ˜</a>ï¼‰å°†è®¤è¯ ident æ”¹ä¸º md5ï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># TYPE  DATABASE        USER            ADDRESS                 METHOD</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># &quot;local&quot; is for Unix domain socket connections only</span></span><br><span class="line"><span class="built_in">local</span>   all             all                                     peer</span><br><span class="line"><span class="comment"># IPv4 local connections:</span></span><br><span class="line">host    all             all             127.0.0.1/32            md5</span><br><span class="line"><span class="comment"># IPv6 local connections:</span></span><br><span class="line">host    all             all             ::1/128                 md5</span><br><span class="line"><span class="comment"># Allow replication connections from localhost, by a user with the</span></span><br><span class="line"><span class="comment"># replication privilege.</span></span><br><span class="line"><span class="comment">#local   replication     postgres                                peer</span></span><br><span class="line"><span class="comment">#host    replication     postgres        127.0.0.1/32            ident</span></span><br><span class="line"><span class="comment">#host    replication     postgres        ::1/128                 ident</span></span><br><span class="line"><span class="comment">#host    replication     sonar           127.0.0.1/32            ident</span></span><br></pre></td></tr></table></figure>
<h3 id="3-sonarqube-79å®‰è£…"><a class="markdownIt-Anchor" href="#3-sonarqube-79å®‰è£…"></a> 3ã€SonarQube 7.9å®‰è£…</h3>
<p>å®˜æ–¹çš„å®‰è£…å¼•å¯¼ï¼š<a href="https://docs.sonarqube.org/7.9/setup/install-server/">https://docs.sonarqube.org/7.9/setup/install-server/</a></p>
<p>å®‰è£…åŒ…ï¼šï¼ˆ<a href="https://binaries.sonarsource.com/Distribution/sonarqube/sonarqube-7.9.6.zip">å®˜æ–¹ä¸‹è½½</a>ï¼‰</p>
<p><strong>åˆ›å»ºsonarç”¨æˆ·</strong></p>
<p>&gt; sudo useradd sonar</p>
<p>&gt; passwd sonar (å¯†ç ï¼šxxxx)</p>
<p>linuxå¹³å°æ–‡ä»¶æ•°é™åˆ¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®ç³»ç»Ÿæœ€å¤§æ–‡ä»¶æ•°</span></span><br><span class="line">sysctl -w vm.max_map_count=262144</span><br><span class="line">sysctl -w fs.file-max=65536</span><br><span class="line"> </span><br><span class="line"><span class="comment"># è®¾ç½®sonarç”¨æˆ·å†æ‰“æ–‡ä»¶æ•° æ–‡ä»¶ï¼š/etc/security/limits.d/99-sonarqube.conf (or /etc/security/limits.conf as you wish)ï¼Œæ³¨ï¼šç»ˆç«¯éœ€é€€å‡ºé‡ç™»ç”Ÿæ•ˆæˆ–sourceåç”Ÿæ•ˆï¼Ÿ</span></span><br><span class="line">sonar -   nofile   65536</span><br><span class="line">sonar -   nproc    4096</span><br></pre></td></tr></table></figure>
<p><strong>å®‰è£…é…ç½®</strong></p>
<ul>
<li>æ•°æ®åº“é“¾æ¥</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt; sonar.jdbc.username=sonarqube</span><br><span class="line">&gt; sonar.jdbc.password=mypassword</span><br><span class="line">&gt; sonar.jdbc.url=jdbc:postgresql://localhost/sonarqube</span><br></pre></td></tr></table></figure>
<ul>
<li>ESå­˜å‚¨</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt; sonar.path.data=/opt/data/sonarqube/data</span><br><span class="line">&gt; sonar.path.temp=/opt/data/sonarqube/temp</span><br></pre></td></tr></table></figure>
<ul>
<li>Web Serveré…ç½®</li>
</ul>
<p>è‡ªå·±è®¾å®šå¯åŠ¨ç«¯å£é…ç½®å³å¯</p>
<p><strong>è„šæœ¬å¯åŠ¨</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; <span class="variable">$&#123;sonar_home&#125;</span>/bin/linux-x86-64/sonar.sh start</span><br></pre></td></tr></table></figure>
<p>æœåŠ¡å™¨éƒ¨ç½²ï¼Œæ³¨æ„åŠ å…¥åˆ°å¼€æœºå¯åŠ¨é¡¹ä¸­,ï¼Œæ­¤å¤„æˆ‘æ˜¯åŠ å…¥ rc.local æ–‡ä»¶ä¸­</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sonarqube server</span></span><br><span class="line">su - sonar -c <span class="string">&quot;/opt/app/sonarqube/sonarqube-7.9.6/bin/linux-x86-64/sonar.sh start&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="4-sonarqube-scanner"><a class="markdownIt-Anchor" href="#4-sonarqube-scanner"></a> 4ã€SonarQube Scanner</h3>
<p>å®˜æ–¹çš„å®‰è£…å¼•å¯¼ï¼š<a href="https://docs.sonarqube.org/7.9/analysis/scan/sonarscanner/">https://docs.sonarqube.org/7.9/analysis/scan/sonarscanner/</a></p>
<p>å®‰è£…åŒ…ï¼šï¼ˆ<a href="https://docs.sonarqube.org/7.9/analysis/scan/sonarscanner/">å®˜æ–¹ä¸‹è½½</a>ï¼‰</p>
<p>å®‰è£…ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®SonarQube Serverï¼Œä½ç½®ï¼š$install_directory/conf/sonar-scanner.properties</span></span><br><span class="line"><span class="comment">#----- Default SonarQube server</span></span><br><span class="line">sonar.host.url=http://localhost:9000</span><br><span class="line"> </span><br><span class="line"><span class="comment"># å°†$install_directory/binï¼ŒåŠ å…¥åˆ°ç¯å¢ƒå˜é‡PATH</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># ä½¿ç”¨ sonar-scanner -h ï¼ŒåšéªŒè¯</span></span><br></pre></td></tr></table></figure>
<p>**æ¯ä¸ªæ‰«æé¡¹ç›®çš„æ ¹ç›®å½•åŠ å…¥ï¼š**sonar-project.properties</p>
<p>sonar-project.propertiesç¤ºä¾‹ï¼š <a href="https://github.com/SonarSource/sonar-scanning-examples">browsed</a> or <a href="https://github.com/SonarSource/sonar-scanning-examples/archive/master.zip">downloaded</a></p>
<h3 id="5-sonarqube-plugin"><a class="markdownIt-Anchor" href="#5-sonarqube-plugin"></a> 5ã€SonarQube Plugin</h3>
<ul>
<li>ç¤¾åŒºç‰ˆæ”¯æŒå¤šåˆ†æ”¯æ£€æµ‹ï¼š <a href="https://github.com/mc1arke/sonarqube-community-branch-plugin">sonarqube-community-branch-plugin</a>ï¼ˆ1.3.2è€ç‰ˆæœ¬ï¼Œå®‰è£…<a href="https://github.com/mc1arke/sonarqube-community-branch-plugin/commit/a6b6db3f30e1ebba7183825542d1f5363b66a831#diff-b335630551682c19a781afebcf4d07bf978fb1f8ac04c6bf87428ed5106870f5">åŒºåˆ«ç°è¯´æ˜</a>ï¼šCopy the plugin JAR file to the <code>extensions/plugins/</code> <strong>and</strong> the <code>lib/common/</code> directories of your SonarQube instance and restart SonarQubeï¼‰</li>
<li>æ±‰åŒ–åŒ…ï¼ˆä¸å»ºè®®ï¼Œæ€»è§‰å¾—æ€ªæ€ªçš„ï¼‰ï¼šç›´æ¥åœ¨åº”ç”¨å¸‚åœºæ£€ç´¢æŒ‰ç…§å¯¹åº”çš„ç‰ˆæœ¬å³å¯ï¼ˆjaræ’ä»¶ä¸‹è½½ï¼š<a href="https://github.com/xuhuisheng/sonar-l10n-zh">sonar-l10n-zh</a>ï¼‰</li>
</ul>
<h3 id="6-ç›¸å…³é…ç½®"><a class="markdownIt-Anchor" href="#6-ç›¸å…³é…ç½®"></a> 6ã€ç›¸å…³é…ç½®</h3>
<ul>
<li><strong>è§£å†³å¢é‡ä»£ç å°äº20è¡Œï¼ŒQGä¸ç”Ÿæ•ˆæƒ…å†µï¼š</strong></li>
</ul>
<p>&gt; é…ç½®ï¼šsonarqube â†’ quality gates â†’ create/copy a new QG , set :Lines to Cover on New Code to 0</p>
<h2 id="é—®é¢˜è®°å½•"><a class="markdownIt-Anchor" href="#é—®é¢˜è®°å½•"></a> é—®é¢˜è®°å½•</h2>
<p><strong>1ã€Some Quality Gate conditions on New Code were ignored because of the small number of New Lines</strong></p>
<p>ä½†åˆ†æ”¯æ¨¡å¼å¢é‡ä»£ç æ‰«æï¼Œå°‘äº20è¡Œæ—¶ï¼Œä»£ç åå‘³é“æ— æ³•æ£€æµ‹åˆ°ï¼Œå¯ä»¥å‚è€ƒï¼š<a href="https://jira.sonarsource.com/browse/SONAR-9352">SONAR-9352</a> æˆ– <a href="https://groups.google.com/g/sonarqube/c/qxQLr7OAioA/m/Dk9J7Ji8BgAJ?pli=1">è®ºå›è®¨è®º</a></p>
<p>è§£å†³ï¼šè§£å†³æ–¹æ¡ˆè¯´æ˜å‚è€ƒ <a href="https://groups.google.com/g/sonarqube/c/qxQLr7OAioA/m/Dk9J7Ji8BgAJ?pli=1">è®ºå›è®¨è®º</a>ï¼Œ</p>
<p>æ­¥éª¤ï¼šsonarqube â†’ quality gates â†’ create/copy a new QG , set :Lines to Cover on New Code to 0</p>
<p><strong>2ã€the main branch has no lines of code</strong></p>
<p>æ‰«æphpï¼Œé‡åˆ°çš„é”™è¯¯ï¼Œä¸»è¦åŸå› æ˜¯å”¯ä¸€çš„phpçš„æ–‡ä»¶åœ¨è§£æé˜¶æ®µå°±å‡ºç°é”™è¯¯ï¼Œæ— æ³•æ­£å¸¸è§£æï¼Œä¹Ÿå°±æ²¡æœ‰æ‰«ææ–‡ä»¶ï¼Œæ›´æ²¡æœ‰æ‰«æç»“æœäº†ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#å‚è€ƒèµ„æ–™"></a> å‚è€ƒèµ„æ–™</h2>
<ol>
<li><a href="https://bbs.huaweicloud.com/blogs/159762">SonarQubeå®‰è£…åŠè¸©å‘ä½“éªŒ</a></li>
<li><a href="https://blog.csdn.net/CN_TangZheng/article/details/109244806">è°ƒç ”sonarqubeç‰ˆæœ¬åŒºåˆ«</a></li>
<li><a href="https://cloud.tencent.com/developer/article/1732805">ä»é›¶å¼€å§‹é’ˆå¯¹ .NET åº”ç”¨çš„ DevOps è¿è¥å®è·µ - Jenkins &amp; SonarQube å®‰è£…é…ç½®</a></li>
</ol>
]]></content>
      <categories>
        <category>SonarQube</category>
      </categories>
      <tags>
        <tag>SonarQube</tag>
        <tag>ä»£ç æ‰«æ</tag>
      </tags>
  </entry>
  <entry>
    <title>Jenkins Pipelineè¯­æ³•è¯¦è§£</title>
    <url>/2021/05/27/Jenkins/Jenkins%20Pipeline%E8%AF%AD%E6%B3%95%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<p>å¦‚ä½•ç¼–å†™æµæ°´çº¿æ–‡ä»¶jenkinsfileå‘¢ï¼Ÿå…¶å®å…¶é‡ç‚¹æ˜¯ä½¿ç”¨<code>Pipelineè¯­æ³•</code>ã€‚ æ‰€ä»¥æ­¤å¤„å°†é‡ç‚¹ä»‹ç»å¦‚ä½•ä½¿ç”¨Pipelineçš„è¯­æ³•ï¼Œä»Pipelineæ’ä»¶2.5ç‰ˆå¼€å§‹ï¼ŒPipelineæ”¯æŒä¸¤ç§ç‹¬ç«‹çš„è¯­æ³•ç»“æ„ï¼š<strong>Declarative Pipeline</strong> å’Œ <strong>Scripted Pipeline</strong>ï¼Œä¸¤è€…éƒ½æ”¯æŒå»ºç«‹è¿ç»­ä¼ é€çš„Pipelineã€‚</p>
<span id="more"></span>
<h2 id="1-æ¦‚è¿°"><a class="markdownIt-Anchor" href="#1-æ¦‚è¿°"></a> 1 æ¦‚è¿°</h2>
<p>å…ˆè¯´ä¸‹æœ€åçš„é€‰æ‹©å§ï¼Œä¸ºä¸BlueOceanç¼–è¾‘å™¨å…¼å®¹ï¼Œ<code>å»ºè®®ä½¿ç”¨Declarative Pipelineçš„æ–¹å¼è¿›è¡Œç¼–å†™</code>,è¿™ç§è¯­æ³•ç»“æ„ä¹Ÿä¼šæ˜¯Jenkins Pipelineæœªæ¥å‘å±•çš„è¶‹åŠ¿ã€‚</p>
<h2 id="2-declarative-pipeline"><a class="markdownIt-Anchor" href="#2-declarative-pipeline"></a> 2 Declarative Pipeline</h2>
<p>ä»Pipeline2.5ç‰ˆæœ¬ä»¥åï¼ŒJenkins Pipelineæ–°å¢äº†ä¸€ç§æ–°çš„è¯­æ³•ç±»å‹Declarative Pipelineï¼ˆå£°æ˜å¼Pipelineï¼‰ï¼Œå®ƒåœ¨Pipelineç³»ç»Ÿä¹‹ä¸Šæä¾›äº†ä¸€ç§æ›´åŠ ç®€å•å’Œæœ‰æ„ä¹‰çš„è¯­æ³•ã€‚</p>
<p>æ‰€æœ‰æœ‰æ•ˆçš„Declarative Pipelineå¿…é¡»åŒ…å«åœ¨ä¸€ä¸ªpipelineå—å†…ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">pipeline &#123; </span><br><span class="line"><span class="comment">/* insert Declarative Pipeline here */</span> </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>Declarative Pipelineéµå¾ªä¸Groovyç›¸åŒçš„è¯­æ³•è§„åˆ™ï¼Œä½†æœ‰ä»¥ä¸‹å‡ ç‚¹ä¾‹å¤–ï¼š</p>
<ul>
<li>
<p>Pipelineçš„é¡¶å±‚å¿…é¡»æ˜¯å—ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯ï¼špipeline { }ã€‚</p>
</li>
<li>
<p>ä¸ç”¨åˆ†å·ä½œä¸ºè¯­å¥åˆ†éš”ç¬¦ï¼Œæ¯ä¸ªå£°æ˜å¿…é¡»ç‹¬ç«‹ä¸€è¡Œã€‚</p>
</li>
<li>
<p>å—é‡Œåªèƒ½åŒ…å«Sectionsï¼ˆç« èŠ‚ï¼‰ã€Directivesï¼ˆæŒ‡ä»¤ï¼‰ã€ Stepsï¼ˆæ­¥éª¤ï¼‰æˆ–èµ‹å€¼è¯­å¥ã€‚</p>
</li>
<li>
<p>å±æ€§å¼•ç”¨ä»¥æ— å‚æ–¹æ³•çš„æ–¹å¼è°ƒç”¨ã€‚ä¾‹å¦‚ï¼Œè¾“å…¥è¢«è§†ä¸ºinputï¼ˆï¼‰ã€‚</p>
</li>
</ul>
<h3 id="21-sectionsç« èŠ‚"><a class="markdownIt-Anchor" href="#21-sectionsç« èŠ‚"></a> 2.1 Sectionsï¼ˆç« èŠ‚ï¼‰</h3>
<p>Declarative Pipelineé‡Œçš„Sectionsé€šå¸¸åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªDirectivesæˆ–Stepsã€‚</p>
<h4 id="agent"><a class="markdownIt-Anchor" href="#agent"></a> agent</h4>
<p>agentæŒ‡å®šæ•´ä¸ªPipelineæˆ–ç‰¹å®šstageåœ¨Jenkinsç¯å¢ƒä¸­æ‰§è¡Œçš„ä½ç½®ã€‚åœ¨pipelineä»£ç å—çš„é¡¶å±‚agentå¿…é¡»è¿›è¡Œå®šä¹‰ï¼Œä½†åœ¨stageçº§ä½¿ç”¨æ˜¯å¯é€‰çš„ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left"><strong>éœ€è¦</strong></th>
<th style="text-align:left">æ˜¯</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>å‚æ•°</strong></td>
<td style="text-align:left">è§å‚æ•°è¯´æ˜</td>
</tr>
<tr>
<td style="text-align:left"><strong>å…è®¸</strong></td>
<td style="text-align:left">åœ¨pipelineé¡¶å±‚ä»£ç å—æˆ–æ¯ä¸ªstageçº§ä»£ç å—ä¸­</td>
</tr>
</tbody>
</table>
<h5 id="å‚æ•°åˆ—è¡¨"><a class="markdownIt-Anchor" href="#å‚æ•°åˆ—è¡¨"></a> å‚æ•°åˆ—è¡¨</h5>
<p>ä¸ºå®ç°Pipelineå¯èƒ½æ‹¥æœ‰çš„å„ç§ç”¨ä¾‹ï¼Œagentæ”¯æŒå‡ ç§ä¸åŒç±»å‹çš„å‚æ•°ã€‚è¿™äº›å‚æ•°å¯ä»¥åº”ç”¨äºpipelineå—çš„é¡¶å±‚ï¼Œä¹Ÿå¯ä»¥åº”ç”¨åœ¨æ¯ä¸ªstageæŒ‡ä»¤å†…ã€‚</p>
<p><strong>any</strong></p>
<p>åœ¨ä»»ä½•å¯ç”¨çš„agent ä¸Šæ‰§è¡ŒPipelineæˆ–stageã€‚ä¾‹å¦‚ï¼šagent any<br>
<strong>none</strong></p>
<p>å½“åœ¨pipelineå—çš„é¡¶å±‚ä½¿ç”¨noneæ—¶ï¼Œå°†ä¸ä¼šä¸ºæ•´ä¸ªPipelineè¿è¡Œåˆ†é…å…¨å±€agent ï¼Œæ¯ä¸ªstageéƒ¨åˆ†å°†éœ€è¦å®šä¹‰å…¶è‡ªå·±çš„agentã€‚</p>
<p><strong>label</strong></p>
<p>æä¾›labelæ ‡ç­¾åç§°ï¼Œåœ¨Jenkinsç¯å¢ƒä¸­å¯ç”¨çš„agentä¸Šæ‰§è¡ŒPipelineæˆ–stageã€‚</p>
<p>ä¾‹å¦‚ï¼šagent { label â€˜my-defined-labelâ€™ }</p>
<p><strong>node</strong></p>
<p>agent { node { label â€˜labelNameâ€™ } }ï¼Œç­‰åŒäº agent { label â€˜labelNameâ€™ }ï¼Œä½†nodeä¹Ÿå…è®¸å…¶ä»–é€‰é¡¹ï¼ˆå¦‚customWorkspaceï¼‰ã€‚</p>
<p><strong>docker</strong></p>
<p>å®šä¹‰æ­¤å‚æ•°æ—¶ï¼Œæ‰§è¡ŒPipelineæˆ–stageæ—¶ä¼šåŠ¨æ€æä¾›ä¸€ä¸ªdockerèŠ‚ç‚¹å»è¿è¡ŒåŸºäºDockerçš„Pipelinesã€‚dockerè¿˜å¯ä»¥æ¥å—ä¸€ä¸ªargså‚æ•°ï¼Œç›´æ¥ä¼ é€’ç»™docker runæŒ‡ä»¤è°ƒç”¨ã€‚</p>
<p>ä¾‹å¦‚ï¼šagent { docker â€˜maven:3-alpineâ€™ }æˆ–</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">agent &#123;</span><br><span class="line">    docker &#123;</span><br><span class="line">        image <span class="string">&#x27;maven:3-alpine&#x27;</span></span><br><span class="line">        label <span class="string">&#x27;my-defined-label&#x27;</span></span><br><span class="line">        args  <span class="string">&#x27;-v /tmp:/tmp&#x27;</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><strong>dockerfile</strong></p>
<p>ä½¿ç”¨ä»Dockerfileä»“åº“ä¸­åŒ…å«çš„dockerfileåˆ›å»ºé•œåƒæ–‡ä»¶æ¥æ„å»ºæ‰§è¡ŒPipelineæˆ–stageã€‚ä¸ºäº†ä½¿ç”¨æ­¤é€‰é¡¹ï¼ŒJenkinsfileå¿…é¡»ä»Multibranch Pipelineæˆ–â€œPipeline from SCM&quot;ä¸­åŠ è½½ã€‚</p>
<p>é»˜è®¤ç›®å½•æ˜¯åœ¨Dockerfileä»“åº“çš„æ ¹ç›®å½•ï¼šagent { dockerfile true }ã€‚å¦‚æœDockerfileéœ€åœ¨å¦ä¸€ä¸ªç›®å½•ä¸­å»ºç«‹ï¼Œå¯ä½¿ç”¨diré€‰é¡¹ï¼šagent { dockerfile { dir â€˜someSubDirâ€™ } }ã€‚</p>
<p>è¿˜å¯ä»¥é€šè¿‡docker build â€¦ä½¿ç”¨additionalBuildArgsé€‰é¡¹ï¼Œå¦‚agent { dockerfile { additionalBuildArgs â€˜â€“build-arg foo=barâ€™ } }ã€‚</p>
<h5 id="é€šç”¨é€‰é¡¹"><a class="markdownIt-Anchor" href="#é€šç”¨é€‰é¡¹"></a> é€šç”¨é€‰é¡¹</h5>
<p>è¿™äº›æ˜¯å¯ä»¥åº”ç”¨äºä¸¤ä¸ªæˆ–å¤šä¸ªagentä¸­çš„é€‰é¡¹ã€‚é™¤éæ˜ç¡®å®šä¹‰ï¼Œå¦åˆ™éå¿…éœ€ã€‚</p>
<p><strong>label</strong></p>
<p>stringå­—ç¬¦ä¸²ã€‚æ ‡è®°åœ¨å“ªé‡Œè¿è¡Œpipelineæˆ–stage</p>
<p>æ­¤é€‰é¡¹é€‚ç”¨äºnodeï¼Œdockerå’Œdockerfileï¼Œå¹¶ä¸”åœ¨nodeä¸­æ˜¯å¿…éœ€çš„ã€‚<br>
<strong>customWorkspace</strong></p>
<p>stringå­—ç¬¦ä¸²ã€‚è‡ªå®šä¹‰è¿è¡Œçš„å·¥ä½œç©ºé—´,å®ƒå¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè‡ªå®šä¹‰å·¥ä½œåŒºå°†ä½äºnodeèŠ‚ç‚¹å·¥ä½œç©ºé—´çš„æ ¹ç›®å½•ä¸‹ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">agent &#123;</span><br><span class="line">    node &#123;</span><br><span class="line">        label <span class="string">&#x27;my-defined-label&#x27;</span></span><br><span class="line">        customWorkspace <span class="string">&#x27;/some/other/path&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>reuseNode</strong><br>
ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œé»˜è®¤ä¸ºfalseã€‚å¦‚æœä¸ºtrueï¼Œåˆ™åœ¨åŒä¸€å·¥ä½œç©ºé—´ä¸­ï¼Œæ­¤é€‰é¡¹é€‚ç”¨äºdockerå’Œdockerfileï¼Œå¹¶ä¸”ä»…åœ¨ç‹¬ç«‹stageä¸­ä½¿ç”¨agentæ—¶æ‰æœ‰æ•ˆã€‚</p>
<h5 id="æ ·ä¾‹"><a class="markdownIt-Anchor" href="#æ ·ä¾‹"></a> æ ·ä¾‹</h5>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Jenkinsfile (Declarative Pipeline)</span></span><br><span class="line">pipeline &#123;</span><br><span class="line">    agent &#123; docker <span class="string">&#x27;maven:3-alpine&#x27;</span> &#125; â‘ </span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">&#x27;Example Build&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh <span class="string">&#x27;mvn -B clean verify&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>â‘ </strong>ä½¿ç”¨â€˜maven:3-alpineâ€™çš„é•œåƒåˆ›å»ºå®¹å™¨ï¼Œæ‰§è¡Œpipelineçš„æ‰€æœ‰æ­¥éª¤ã€‚</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Jenkinsfile (Declarative Pipeline)</span></span><br><span class="line">pipeline &#123;</span><br><span class="line">    agent none â‘ </span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">&#x27;Example Build&#x27;</span>) &#123;</span><br><span class="line">            agent &#123; docker <span class="string">&#x27;maven:3-alpine&#x27;</span> &#125; â‘¡</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">&#x27;Hello, Maven&#x27;</span></span><br><span class="line">                sh <span class="string">&#x27;mvn --version&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&#x27;Example Test&#x27;</span>) &#123;</span><br><span class="line">            agent &#123; docker <span class="string">&#x27;openjdk:8-jre&#x27;</span> &#125; â‘¢</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">&#x27;Hello, JDK&#x27;</span></span><br><span class="line">                sh <span class="string">&#x27;java -version&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>â‘ </strong>agent noneåœ¨Pipelineé¡¶å±‚å®šä¹‰ï¼Œè¡¨ç¤ºå°†ä¸ä¼šä¸ºæ•´ä¸ªPipelineè¿è¡Œåˆ†é…å…¨å±€agentï¼Œæ¯ä¸ªstageéœ€è‡ªå·±è®¾ç½®agentã€‚</p>
<p><strong>â‘¡</strong>ä½¿ç”¨â€˜maven:3-alpineâ€™çš„é•œåƒåˆ›å»ºå®¹å™¨ï¼Œæ‰§è¡Œæ­¤é˜¶æ®µä¸­çš„æ­¥éª¤ã€‚</p>
<p><strong>â‘¢</strong>ä½¿ç”¨â€˜openjdk:8-jreâ€™çš„é•œåƒåˆ›å»ºå®¹å™¨ï¼Œæ‰§è¡Œæ­¤é˜¶æ®µä¸­çš„æ­¥éª¤ã€‚</p>
<h4 id="post"><a class="markdownIt-Anchor" href="#post"></a> post</h4>
<p>å®šä¹‰Pipelineæˆ–stageè¿è¡Œç»“æŸåçš„æ“ä½œã€‚postæ”¯æŒä»¥ä¸‹ç±»å‹çš„ä»£ç å—ï¼šalwaysï¼Œchangedï¼Œfailureï¼Œsuccessï¼Œunstableå’Œabortedã€‚è¿™äº›ä»£ç å—å…è®¸åœ¨Pipelineæˆ–stageè¿è¡Œç»“æŸæ—¶æ‰§è¡Œç›¸å…³æ­¥éª¤ï¼Œå…·ä½“å–å†³äºPipelineçš„è¿è¡ŒçŠ¶æ€ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left"><strong>éœ€è¦</strong></th>
<th style="text-align:left">å¦</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>å‚æ•°</strong></td>
<td style="text-align:left">æ— </td>
</tr>
<tr>
<td style="text-align:left"><strong>å…è®¸</strong></td>
<td style="text-align:left">åœ¨pipelineé¡¶å±‚ä»£ç å—æˆ–æ¯ä¸ªstageçº§ä»£ç å—ä¸­</td>
</tr>
</tbody>
</table>
<h5 id="å‚æ•°åˆ—è¡¨-2"><a class="markdownIt-Anchor" href="#å‚æ•°åˆ—è¡¨-2"></a> å‚æ•°åˆ—è¡¨</h5>
<p><strong>always</strong></p>
<p>ç»“æŸæ—¶è¿è¡Œï¼Œæ— è®ºPipelineè¿è¡Œçš„å®ŒæˆçŠ¶æ€å¦‚ä½•ã€‚</p>
<p><strong>changed</strong></p>
<p>åªæœ‰å½“å‰Pipelineè¿è¡Œçš„çŠ¶æ€ä¸å…ˆå‰å®Œæˆçš„Pipelineçš„çŠ¶æ€ä¸åŒæ—¶ï¼Œæ‰èƒ½è¿è¡Œã€‚</p>
<p><strong>failure</strong></p>
<p>åªæœ‰å½“å‰Pipelineå¤„äºâ€œå¤±è´¥â€çŠ¶æ€æ—¶æ‰è¿è¡Œï¼Œé€šå¸¸ç”¨çº¢è‰²æŒ‡ç¤ºçš„Web UIè¡¨ç¤ºã€‚</p>
<p><strong>success</strong></p>
<p>åªæœ‰å½“å‰Pipelineå…·æœ‰â€œæˆåŠŸâ€çŠ¶æ€æ—¶æ‰è¿è¡Œï¼Œé€šå¸¸ç”¨è“è‰²æˆ–ç»¿è‰²æŒ‡ç¤ºçš„Web UIè¡¨ç¤ºã€‚</p>
<p><strong>unstable</strong></p>
<p>åªæœ‰å½“å‰Pipelineå…·æœ‰â€œä¸ç¨³å®šâ€çŠ¶æ€ï¼Œä¸€èˆ¬ç”±æµ‹è¯•å¤±è´¥ï¼Œä»£ç è¿ä¾‹ç­‰å¼•èµ·ï¼Œæ‰èƒ½è¿è¡Œã€‚é€šå¸¸ç”¨é»„è‰²æŒ‡ç¤ºçš„Web UIè¡¨ç¤ºã€‚</p>
<p><strong>aborted</strong></p>
<p>åªæœ‰å½“å‰Pipelineå¤„äºâ€œä¸­æ­¢â€çŠ¶æ€æ—¶ï¼Œæ‰ä¼šè¿è¡Œï¼Œé€šå¸¸æ˜¯ç”±äºPipelineè¢«æ‰‹åŠ¨ä¸­æ­¢ã€‚é€šå¸¸ç”¨ç°è‰²æŒ‡ç¤ºçš„Web UIè¡¨ç¤ºã€‚</p>
<h5 id="æ ·ä¾‹-2"><a class="markdownIt-Anchor" href="#æ ·ä¾‹-2"></a> æ ·ä¾‹</h5>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Jenkinsfile (Declarative Pipeline)</span></span><br><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">&#x27;Example&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">&#x27;Hello World&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    post &#123; â‘ </span><br><span class="line">        always &#123; â‘¡</span><br><span class="line">            echo <span class="string">&#x27;I will always say Hello again!&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â‘ postç« èŠ‚é€šå¸¸ä¼šæ”¾åœ¨pipelineæœ«ç«¯ã€‚</p>
<p>â‘¡postä»£ç å—é‡ŒåŒ…æ‹¬stepsç« èŠ‚çš„å†…å®¹ã€‚</p>
<h4 id="stages"><a class="markdownIt-Anchor" href="#stages"></a> stages</h4>
<p>åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªstageçš„åºåˆ—ï¼ŒPipelineçš„å¤§éƒ¨åˆ†å·¥ä½œåœ¨æ­¤æ‰§è¡Œã€‚å»ºè®®stagesè‡³å°‘åŒ…å«è‡³å°‘ä¸€ä¸ªstageæŒ‡ä»¤ï¼Œç”¨äºè¿æ¥å„ä¸ªäº¤ä»˜è¿‡ç¨‹ï¼Œå¦‚æ„å»ºï¼Œæµ‹è¯•å’Œéƒ¨ç½²ç­‰ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left"><strong>éœ€è¦</strong></th>
<th style="text-align:left">æ˜¯</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>å‚æ•°</strong></td>
<td style="text-align:left">æ— </td>
</tr>
<tr>
<td style="text-align:left"><strong>å…è®¸</strong></td>
<td style="text-align:left">åªèƒ½æœ‰ä¸€æ¬¡ï¼Œåœ¨pipelineä»£ç å—å†…ã€‚</td>
</tr>
</tbody>
</table>
<h5 id="æ ·ä¾‹-3"><a class="markdownIt-Anchor" href="#æ ·ä¾‹-3"></a> æ ·ä¾‹</h5>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Jenkinsfile (Declarative Pipeline)</span></span><br><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    stages &#123; â‘ </span><br><span class="line">        stage(<span class="string">&#x27;Example&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">&#x27;Hello World&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>â‘ </strong>stagesç« èŠ‚é€šå¸¸è·Ÿéšåœ¨agent,optionsç­‰æŒ‡ä»¤åé¢ã€‚</p>
<h4 id="steps"><a class="markdownIt-Anchor" href="#steps"></a> steps</h4>
<p>stepsåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªåœ¨stageå—ä¸­æ‰§è¡Œçš„stepåºåˆ—ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left"><strong>éœ€è¦</strong></th>
<th style="text-align:left">æ˜¯</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>å‚æ•°</strong></td>
<td style="text-align:left">æ— </td>
</tr>
<tr>
<td style="text-align:left"><strong>å…è®¸</strong></td>
<td style="text-align:left">åœ¨æ¯ä¸ªstageä»£ç å—å†…ã€‚</td>
</tr>
</tbody>
</table>
<h5 id="æ ·ä¾‹-4"><a class="markdownIt-Anchor" href="#æ ·ä¾‹-4"></a> æ ·ä¾‹</h5>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Jenkinsfile (Declarative Pipeline)</span></span><br><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    stages &#123; </span><br><span class="line">        stage(<span class="string">&#x27;Example&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;â‘ </span><br><span class="line">                echo <span class="string">&#x27;Hello World&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>â‘  stepsç« èŠ‚å¿…é¡»åŒ…æ‹¬ä¸€ä¸ªæˆ–å¤šä¸ªstepã€‚</strong></p>
<h3 id="22-directives-æŒ‡ä»¤"><a class="markdownIt-Anchor" href="#22-directives-æŒ‡ä»¤"></a> 2.2 Directives ï¼ˆæŒ‡ä»¤ï¼‰</h3>
<h4 id="environment"><a class="markdownIt-Anchor" href="#environment"></a> environment</h4>
<p>environmentæŒ‡ä»¤æŒ‡å®šä¸€ç³»åˆ—é”®å€¼å¯¹ï¼Œè¿™äº›é”®å€¼å¯¹å°†è¢«å®šä¹‰ä¸ºæ‰€æœ‰stepæˆ–stageä¸­stepçš„ç¯å¢ƒå˜é‡ï¼Œå…·ä½“å–å†³äºenvironmentæŒ‡ä»¤åœ¨Pipelineä¸­çš„ä½ç½®ã€‚</p>
<p>è¯¥æŒ‡ä»¤æ”¯æŒä¸€ç§ç‰¹æ®Šçš„æ–¹æ³•credentials()ï¼Œå¯é€šè¿‡æ ‡è¯†ç¬¦è®¿é—®Jenkinsç¯å¢ƒä¸­é¢„å®šä¹‰å¥½çš„Credentialå‡­è¯ã€‚</p>
<p>å¯¹äºâ€œSecret Textâ€ç±»å‹çš„å‡­æ®ï¼Œcredentials()æ–¹æ³•éœ€ç¡®ä¿æŒ‡å®šçš„ç¯å¢ƒå˜é‡åŒ…å«Secret Textå†…å®¹ï¼Œå¯¹äºâ€œStandard username and password&quot;â€ç±»å‹çš„å‡­è¯ï¼ŒæŒ‡å®šçš„ç¯å¢ƒå˜é‡éœ€è¦è®¾ç½®ä¸ºusername:passwordã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left"><strong>éœ€è¦</strong></th>
<th style="text-align:left">å¦</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>å‚æ•°</strong></td>
<td style="text-align:left">æ— </td>
</tr>
<tr>
<td style="text-align:left"><strong>å…è®¸</strong></td>
<td style="text-align:left">åœ¨pipelineå—å†…æˆ–stageæŒ‡ä»¤å†…ã€‚</td>
</tr>
</tbody>
</table>
<h5 id="æ ·ä¾‹-5"><a class="markdownIt-Anchor" href="#æ ·ä¾‹-5"></a> æ ·ä¾‹</h5>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Jenkinsfile (Declarative Pipeline)</span></span><br><span class="line">environment</span><br><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    environment &#123; â‘ </span><br><span class="line">        CC = <span class="string">&#x27;clang&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">&#x27;Example&#x27;</span>) &#123;</span><br><span class="line">            environment &#123; â‘¡</span><br><span class="line">                AN_ACCESS_KEY = credentials(<span class="string">&#x27;my-prefined-secret-text&#x27;</span>) â‘¢</span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh <span class="string">&#x27;printenv&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>â‘ </strong>environmentæŒ‡ä»¤æ”¾åœ¨pipelineé¡¶çº§å—ä¸­ï¼Œå°†é€‚ç”¨pipelineæ‰€æœ‰æ­¥éª¤ã€‚</p>
<p><strong>â‘¡</strong>environmentæŒ‡ä»¤æ”¾åœ¨stageä¸­ï¼Œç»™å®šçš„ç¯å¢ƒå˜é‡å°†åªé€‚ç”¨è¯¥stageä¸­çš„æ­¥éª¤ã€‚</p>
<p><strong>â‘¢</strong>environmentå—ä¸­ä½¿ç”¨credentials()æ–¹æ³•ï¼Œå¯ä»¥è®¿é—®Jenkinsç¯å¢ƒä¸­é¢„å®šä¹‰çš„å‡­è¯ã€‚</p>
<h4 id="options"><a class="markdownIt-Anchor" href="#options"></a> options</h4>
<p>optionsæŒ‡ä»¤å…è®¸åœ¨Pipelineå†…é…ç½®Pipelineä¸“ç”¨é€‰é¡¹ã€‚Pipelineæœ¬èº«æä¾›äº†è®¸å¤šé€‰é¡¹ï¼Œä¾‹å¦‚buildDiscarderï¼Œå®ƒä»¬ä¹Ÿå¯ä»¥ç”±Jenkinsæ’ä»¶æä¾›ï¼Œä¾‹å¦‚ timestampsã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left"><strong>éœ€è¦</strong></th>
<th style="text-align:left">å¦</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>å‚æ•°</strong></td>
<td style="text-align:left">æ— </td>
</tr>
<tr>
<td style="text-align:left"><strong>å…è®¸</strong></td>
<td style="text-align:left">åªèƒ½æœ‰ä¸€æ¬¡ï¼Œåœ¨pipelineä»£ç å—å†…ã€‚</td>
</tr>
</tbody>
</table>
<h5 id="å‚æ•°åˆ—è¡¨-3"><a class="markdownIt-Anchor" href="#å‚æ•°åˆ—è¡¨-3"></a> å‚æ•°åˆ—è¡¨</h5>
<p><strong>buildDiscarder</strong></p>
<p>pipelineä¿æŒæ„å»ºçš„æœ€å¤§ä¸ªæ•°ã€‚ä¾‹å¦‚ï¼š</p>
<p>options{buildDiscarder(logRotator(numToKeepStr: â€˜1â€™))}</p>
<p><strong>disableConcurrentBuilds</strong></p>
<p>ä¸å…è®¸å¹¶è¡Œæ‰§è¡ŒPipeline,å¯ç”¨äºé˜²æ­¢åŒæ—¶è®¿é—®å…±äº«èµ„æºç­‰ã€‚ä¾‹å¦‚ï¼š</p>
<p>options {disableConcurrentBuilds()}</p>
<p><strong>skipDefaultCheckout</strong></p>
<p>é»˜è®¤è·³è¿‡æ¥è‡ªæºä»£ç æ§åˆ¶çš„ä»£ç ã€‚ä¾‹å¦‚ï¼š</p>
<p>options {skipDefaultCheckout()}</p>
<p><strong>skipStagesAfterUnstable</strong></p>
<p>ä¸€æ—¦æ„å»ºçŠ¶æ€è¿›å…¥äº†â€œUnstableâ€çŠ¶æ€ï¼Œå°±è·³è¿‡æ­¤stageã€‚ä¾‹å¦‚ï¼š</p>
<p>options {skipStagesAfterUnstable()}</p>
<p><strong>timeout</strong><br>
è®¾ç½®Pipelineè¿è¡Œçš„è¶…æ—¶æ—¶é—´ã€‚ä¾‹å¦‚ï¼š</p>
<p>options {timeout(time: 1, unit: â€˜HOURSâ€™)}F</p>
<p><strong>retry</strong></p>
<p>å¤±è´¥åï¼Œé‡è¯•æ•´ä¸ªPipelineçš„æ¬¡æ•°ã€‚ä¾‹å¦‚ï¼š</p>
<p>options {retry(3)}</p>
<p><strong>timestamps</strong></p>
<p>é¢„å®šä¹‰ç”±Pipelineç”Ÿæˆçš„æ‰€æœ‰æ§åˆ¶å°è¾“å‡ºæ—¶é—´ã€‚ä¾‹å¦‚ï¼š</p>
<p>options {timestamps()}</p>
<h5 id="æ ·ä¾‹-6"><a class="markdownIt-Anchor" href="#æ ·ä¾‹-6"></a> æ ·ä¾‹</h5>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Jenkinsfile (Declarative Pipeline)</span></span><br><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    options &#123; </span><br><span class="line">        timeout(<span class="attr">time:</span> <span class="number">1</span>, <span class="attr">unit:</span> <span class="string">&#x27;HOURS&#x27;</span>) â‘ </span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">&#x27;Example&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">&#x27;Hello World&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>â‘ </strong>è®¾ç½®pipelineå…¨å±€çš„è¶…æ—¶æ—¶é—´ä¸º1å°æ—¶ï¼Œè¶…æ—¶åå°†ä¼šè‡ªåŠ¨ç»ˆæ­¢pipelineè¿è¡Œã€‚</p>
<h4 id="parameters"><a class="markdownIt-Anchor" href="#parameters"></a> parameters</h4>
<p>parametersæŒ‡ä»¤æä¾›ç”¨æˆ·åœ¨è§¦å‘Pipelineæ—¶çš„å‚æ•°åˆ—è¡¨ã€‚è¿™äº›å‚æ•°å€¼é€šè¿‡paramså¯¹è±¡å¯ç”¨äºPipelineæ­¥éª¤ï¼Œå…·ä½“ç”¨æ³•å¦‚ä¸‹</p>
<table>
<thead>
<tr>
<th style="text-align:left"><strong>éœ€è¦</strong></th>
<th style="text-align:left">å¦</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>å‚æ•°</strong></td>
<td style="text-align:left">æ— </td>
</tr>
<tr>
<td style="text-align:left"><strong>å…è®¸</strong></td>
<td style="text-align:left">åªèƒ½æœ‰ä¸€æ¬¡ï¼Œåœ¨pipelineä»£ç å—å†…ã€‚</td>
</tr>
</tbody>
</table>
<h5 id="å‚æ•°åˆ—è¡¨-4"><a class="markdownIt-Anchor" href="#å‚æ•°åˆ—è¡¨-4"></a> å‚æ•°åˆ—è¡¨</h5>
<p><strong>string</strong></p>
<p>stringç±»å‹çš„å‚æ•°, ä¾‹å¦‚:</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">parameters &#123; </span><br><span class="line">string(<span class="attr">name:</span> <span class="string">&#x27;DEPLOY_ENV&#x27;</span>, <span class="attr">defaultValue:</span> <span class="string">&#x27;staging&#x27;</span>, <span class="attr">description:</span> <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p><strong>booleanParam</strong></p>
<p>booleanç±»å‹çš„å‚æ•°, ä¾‹å¦‚:</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">parameters &#123;</span><br><span class="line"> booleanParam(<span class="attr">name:</span> <span class="string">&#x27;DEBUG_BUILD&#x27;</span>, <span class="attr">defaultValue:</span> <span class="literal">true</span>, <span class="attr">description:</span> <span class="string">&#x27;&#x27;</span>) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆªè‡³å‘ç¨¿ï¼ŒJenkinsç¤¾åŒºç›®å‰å·²æ”¯æŒ[booleanParam, choice, credentials, file, text, password, run, string]è¿™å‡ ç§å‚æ•°ç±»å‹ï¼Œå…¶ä»–é«˜çº§å‚æ•°åŒ–ç±»å‹ä¹Ÿåœ¨é™†ç»­å®Œå–„ä¸­ã€‚</p>
<h5 id="æ ·ä¾‹-7"><a class="markdownIt-Anchor" href="#æ ·ä¾‹-7"></a> æ ·ä¾‹</h5>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Jenkinsfile (Declarative Pipeline)</span></span><br><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    parameters &#123;</span><br><span class="line">        string(<span class="attr">name:</span> <span class="string">&#x27;PERSON&#x27;</span>, <span class="attr">defaultValue:</span> <span class="string">&#x27;Mr Jenkins&#x27;</span>, <span class="attr">description:</span> <span class="string">&#x27;Who should I say hello to?&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">&#x27;Example&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">&quot;Hello $&#123;params.PERSON&#125;&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="triggers"><a class="markdownIt-Anchor" href="#triggers"></a> triggers</h4>
<p>triggersæŒ‡ä»¤å®šä¹‰äº†Pipelineè‡ªåŠ¨åŒ–è§¦å‘çš„æ–¹å¼ã€‚å¯¹äºä¸æºä»£ç é›†æˆçš„Pipelineï¼Œå¦‚GitHubæˆ–BitBucketï¼Œtriggerså¯èƒ½ä¸éœ€è¦åŸºäºwebhookçš„é›†æˆä¹Ÿå·²ç»å­˜åœ¨ã€‚ç›®å‰åªæœ‰ä¸¤ä¸ªå¯ç”¨çš„è§¦å‘å™¨ï¼šcronã€pollSCMå’Œupstreamã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left"><strong>éœ€è¦</strong></th>
<th style="text-align:left">å¦</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>å‚æ•°</strong></td>
<td style="text-align:left">æ— </td>
</tr>
<tr>
<td style="text-align:left"><strong>å…è®¸</strong></td>
<td style="text-align:left">åªèƒ½æœ‰ä¸€æ¬¡ï¼Œåœ¨pipelineä»£ç å—å†…ã€‚</td>
</tr>
</tbody>
</table>
<p><strong>cron</strong></p>
<p>æ¥å—ä¸€ä¸ªcroné£æ ¼çš„å­—ç¬¦ä¸²æ¥å®šä¹‰Pipelineè§¦å‘çš„å¸¸è§„é—´éš”ï¼Œä¾‹å¦‚ï¼š</p>
<p>triggers {cron(â€˜H 4/* 0 0 1-5â€™)}</p>
<p><strong>pollSCM</strong><br>
æ¥å—ä¸€ä¸ªcroné£æ ¼çš„å­—ç¬¦ä¸²æ¥å®šä¹‰Jenkinsæ£€æŸ¥SCMæºæ›´æ”¹çš„å¸¸è§„é—´éš”ã€‚å¦‚æœå­˜åœ¨æ–°çš„æ›´æ”¹ï¼Œåˆ™Pipelineå°†è¢«é‡æ–°è§¦å‘ã€‚ä¾‹å¦‚ï¼štriggers {pollSCM(â€˜H 4/* 0 0 1-5â€™)}</p>
<p><strong>upstream</strong></p>
<p>å¯æ¥å—å¤šä¸ªjobåç§°ä»¥åŠä¸€ä¸ªthresholdè®¾ç½®å‚æ•°ã€‚ä»»ä½•ä¸€ä¸ªjobä»¥ç¬¦åˆthresholdæ¡ä»¶å®Œæˆåï¼Œå‡å¯ä»¥è§¦å‘Pipelineçš„è¿è¡Œã€‚ä¸¾ä¾‹ï¼š{ upstream(upstreamProjects: â€˜job1,job2â€™, threshold: hudson.model.Result.SUCCESS) }</p>
<h5 id="æ ·ä¾‹-8"><a class="markdownIt-Anchor" href="#æ ·ä¾‹-8"></a> æ ·ä¾‹</h5>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Jenkinsfile (Declarative Pipeline)</span></span><br><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    triggers &#123;</span><br><span class="line">        cron(<span class="string">&#x27;H 4/* 0 0 1-5&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">&#x27;Example&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">&#x27;Hello World&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="stage"><a class="markdownIt-Anchor" href="#stage"></a> stage</h4>
<p>stageæŒ‡ä»¤åŒ…å«åœ¨stagesä¸­ï¼ŒåŒ…å«stepã€agentï¼ˆå¯é€‰ï¼‰æˆ–å…¶ä»–ç‰¹å®šåŒ…å«äºstageä¸­çš„æŒ‡ä»¤ã€‚å®é™…ä¸Šï¼ŒPipelineå®Œæˆçš„æ‰€æœ‰å®é™…å·¥ä½œéƒ½åŒ…å«åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªstageæŒ‡ä»¤ä¸­ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left"><strong>éœ€è¦</strong></th>
<th style="text-align:left">è‡³å°‘ä¸€ä¸ª</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>å‚æ•°</strong></td>
<td style="text-align:left">ä¸€ä¸ªå¼ºåˆ¶å‚æ•°ï¼Œä¸€ä¸ªæ ‡è¯†stageåç§°çš„å­—ç¬¦ä¸²ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><strong>å…è®¸</strong></td>
<td style="text-align:left">åœ¨stagesç« èŠ‚å†…ã€‚</td>
</tr>
</tbody>
</table>
<h5 id="æ ·ä¾‹-9"><a class="markdownIt-Anchor" href="#æ ·ä¾‹-9"></a> æ ·ä¾‹</h5>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Jenkinsfile (Declarative Pipeline)</span></span><br><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">&#x27;Example&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">&#x27;Hello World&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="tools"><a class="markdownIt-Anchor" href="#tools"></a> tools</h4>
<p>é€šè¿‡toolså¯è‡ªåŠ¨å®‰è£…å·¥å…·ï¼Œå¹¶æ”¾ç½®ç¯å¢ƒå˜é‡åˆ°PATHã€‚å¦‚æœagent noneï¼Œè¿™å°†è¢«å¿½ç•¥ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left"><strong>éœ€è¦</strong></th>
<th style="text-align:left">å¦</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>å‚æ•°</strong></td>
<td style="text-align:left">æ— </td>
</tr>
<tr>
<td style="text-align:left"><strong>å…è®¸</strong></td>
<td style="text-align:left">åœ¨pipelineå—å†…æˆ–stageæŒ‡ä»¤å†…ã€‚</td>
</tr>
</tbody>
</table>
<p><strong>æ”¯æŒçš„Tools</strong></p>
<p>maven</p>
<p>jdk</p>
<p>gradle</p>
<h5 id="æ ·ä¾‹-10"><a class="markdownIt-Anchor" href="#æ ·ä¾‹-10"></a> æ ·ä¾‹</h5>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Jenkinsfile (Declarative Pipeline)</span></span><br><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    tools &#123;</span><br><span class="line">        maven <span class="string">&#x27;apache-maven-3.0.1&#x27;</span> â‘ </span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">&#x27;Example&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh <span class="string">&#x27;mvn --version&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>â‘ </strong>è°ƒç”¨çš„toolå¿…é¡»è¢«é¢„ç½®åœ¨Jenkinsä¸­ï¼Œå¯é€šè¿‡<strong>Manage Jenkins</strong>â†’<strong>Global Tool Configurationé…ç½®ã€‚</strong></p>
<h4 id="when"><a class="markdownIt-Anchor" href="#when"></a> when</h4>
<p>whenæŒ‡ä»¤å…è®¸Pipelineæ ¹æ®ç»™å®šçš„æ¡ä»¶ç¡®å®šæ˜¯å¦æ‰§è¡Œè¯¥é˜¶æ®µã€‚whenæŒ‡ä»¤å¿…é¡»è‡³å°‘åŒ…å«ä¸€ä¸ªæ¡ä»¶ï¼Œå¦‚æœwhenæŒ‡ä»¤åŒ…å«å¤šä¸ªæ¡ä»¶ï¼Œåˆ™åªæœ‰æ‰€æœ‰å­æ¡ä»¶è¿”å›trueæ—¶æ‰ä¼šæ‰§è¡Œstageï¼Œè¿™ä¸å­æ¡ä»¶åµŒå¥—åœ¨allOfç›¸åŒï¼ˆè§ä¸‹é¢çš„ä¾‹å­ï¼‰ã€‚</p>
<p>æ›´å¤æ‚çš„æ¡ä»¶ç»“æ„å¯ä½¿ç”¨åµŒå¥—æ¡ä»¶ï¼šnotï¼ŒallOfæˆ–anyOfï¼ŒåµŒå¥—æ¡ä»¶å¯ä»¥åµŒå¥—åˆ°ä»»æ„æ·±åº¦ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left"><strong>éœ€è¦</strong></th>
<th style="text-align:left">å¦</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>å‚æ•°</strong></td>
<td style="text-align:left">æ— </td>
</tr>
<tr>
<td style="text-align:left"><strong>å…è®¸</strong></td>
<td style="text-align:left">åœ¨stageæŒ‡ä»¤å†…ã€‚</td>
</tr>
</tbody>
</table>
<h5 id="å†…ç½®æ¡ä»¶"><a class="markdownIt-Anchor" href="#å†…ç½®æ¡ä»¶"></a> å†…ç½®æ¡ä»¶</h5>
<p><strong>branch</strong></p>
<p>å½“æ­£åœ¨æ„å»ºçš„åˆ†æ”¯ä¸ç»™å‡ºçš„åˆ†æ”¯æ¨¡å¼åŒ¹é…æ—¶æ‰§è¡Œï¼Œä¾‹å¦‚ï¼šwhen { branch â€˜masterâ€™ }ã€‚è¯·æ³¨æ„ï¼Œè¿™ä»…é€‚ç”¨äºmultibranch Pipelineã€‚</p>
<p><strong>environment</strong></p>
<p>å½“æŒ‡å®šçš„ç¯å¢ƒå˜é‡è®¾ç½®ä¸ºæŒ‡å®šå€¼æ—¶æ‰§è¡Œï¼Œä¾‹å¦‚ï¼š when { environment name: â€˜DEPLOY_TOâ€™, value: â€˜productionâ€™ }</p>
<p><strong>expression</strong></p>
<p>å½“æŒ‡å®šçš„Groovyè¡¨è¾¾å¼æ±‚å€¼ä¸ºtrueæ—¶æ‰§è¡Œï¼Œä¾‹å¦‚ï¼š when { expression { return params.DEBUG_BUILD } }</p>
<p><strong>not</strong></p>
<p>å½“åµŒå¥—æ¡ä»¶ä¸ºfalseæ—¶æ‰§è¡Œã€‚å¿…é¡»åŒ…å«ä¸€ä¸ªæ¡ä»¶ã€‚ä¾‹å¦‚ï¼šwhen { not { branch â€˜masterâ€™ } }</p>
<p><strong>allOf</strong></p>
<p>å½“æ‰€æœ‰åµŒå¥—æ¡ä»¶éƒ½ä¸ºtrueæ—¶æ‰§è¡Œã€‚å¿…é¡»è‡³å°‘åŒ…å«ä¸€ä¸ªæ¡ä»¶ã€‚ä¾‹å¦‚ï¼šwhen { allOf { branch â€˜masterâ€™; environment name: â€˜DEPLOY_TOâ€™, value: â€˜productionâ€™ } }</p>
<p><strong>anyOf</strong></p>
<p>å½“è‡³å°‘ä¸€ä¸ªåµŒå¥—æ¡ä»¶ä¸ºçœŸæ—¶æ‰§è¡Œã€‚å¿…é¡»è‡³å°‘åŒ…å«ä¸€ä¸ªæ¡ä»¶ã€‚ä¾‹å¦‚ï¼šwhen { anyOf { branch â€˜masterâ€™; branch â€˜stagingâ€™ } }</p>
<h5 id="æ ·ä¾‹-11"><a class="markdownIt-Anchor" href="#æ ·ä¾‹-11"></a> æ ·ä¾‹</h5>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Jenkinsfile (Declarative Pipeline)</span></span><br><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">&#x27;Example Build&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">&#x27;Hello World&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&#x27;Example Deploy&#x27;</span>) &#123;</span><br><span class="line">            when &#123;</span><br><span class="line">                branch <span class="string">&#x27;production&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">&#x27;Deploying&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Jenkinsfile (Declarative Pipeline)</span></span><br><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">&#x27;Example Build&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">&#x27;Hello World&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&#x27;Example Deploy&#x27;</span>) &#123;</span><br><span class="line">            when &#123;</span><br><span class="line">                expression &#123; BRANCH_NAME ==~ <span class="regexp">/(production|staging)/</span> &#125;</span><br><span class="line">                anyOf &#123;</span><br><span class="line">                    environment <span class="attr">name:</span> <span class="string">&#x27;DEPLOY_TO&#x27;</span>, <span class="attr">value:</span> <span class="string">&#x27;production&#x27;</span></span><br><span class="line">                    environment <span class="attr">name:</span> <span class="string">&#x27;DEPLOY_TO&#x27;</span>, <span class="attr">value:</span> <span class="string">&#x27;staging&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">&#x27;Deploying&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="23-parallelå¹¶è¡Œ"><a class="markdownIt-Anchor" href="#23-parallelå¹¶è¡Œ"></a> 2.3 Parallel(å¹¶è¡Œ)</h3>
<p>Declarative Pipelineçš„stagesä¸­å¯èƒ½åŒ…å«å¤šä¸ªåµŒå¥—çš„stage, å¯¹ç›¸äº’ä¸å­˜åœ¨ä¾èµ–çš„stageå¯ä»¥é€šè¿‡å¹¶è¡Œçš„æ–¹å¼æ‰§è¡Œï¼Œä»¥æå‡pipelineçš„è¿è¡Œæ•ˆç‡ã€‚</p>
<p>å¦å¤–ï¼Œé€šè¿‡åœ¨æŸä¸ªstageä¸­è®¾ç½®â€œfailFast trueâ€ï¼Œå¯å®ç°å½“è¿™ä¸ªstageè¿è¡Œå¤±è´¥çš„æ—¶å€™ï¼Œå¼ºè¿«æ‰€æœ‰parallel stagesä¸­æ­¢è¿è¡Œï¼ˆè¯¦è§ä¸‹é¢çš„ä¾‹å­ï¼‰ã€‚</p>
<h5 id="æ ·ä¾‹-12"><a class="markdownIt-Anchor" href="#æ ·ä¾‹-12"></a> æ ·ä¾‹</h5>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Jenkinsfile (Declarative Pipeline)</span></span><br><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">&#x27;Non-Parallel Stage&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">&#x27;This stage will be executed first.&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&#x27;Parallel Stage&#x27;</span>) &#123;</span><br><span class="line">            when &#123;</span><br><span class="line">                branch <span class="string">&#x27;master&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">            failFast <span class="literal">true</span></span><br><span class="line">            parallel &#123;</span><br><span class="line">                stage(<span class="string">&#x27;Branch A&#x27;</span>) &#123;</span><br><span class="line">                    agent &#123;</span><br><span class="line">                        label <span class="string">&quot;for-branch-a&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    steps &#123;</span><br><span class="line">                        echo <span class="string">&quot;On Branch A&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                stage(<span class="string">&#x27;Branch B&#x27;</span>) &#123;</span><br><span class="line">                    agent &#123;</span><br><span class="line">                        label <span class="string">&quot;for-branch-b&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    steps &#123;</span><br><span class="line">                        echo <span class="string">&quot;On Branch B&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="24-stepsæ­¥éª¤"><a class="markdownIt-Anchor" href="#24-stepsæ­¥éª¤"></a> 2.4 Stepsï¼ˆæ­¥éª¤ï¼‰</h3>
<p>Declarative Pipelineå¯ä½¿ç”¨Pipeline Stepsæ‰‹å†Œä¸­çš„æ‰€æœ‰å¯ç”¨æ­¥éª¤ï¼Œä»¥åŠä»¥ä¸‹ä»…åœ¨Declarative Pipelineä¸­æ”¯æŒçš„æ­¥éª¤ã€‚</p>
<p>Pipeline Stepsreferenceï¼š<a href="https://jenkins.io/doc/pipeline/steps/">https://jenkins.io/doc/pipeline/steps/</a></p>
<h4 id="script"><a class="markdownIt-Anchor" href="#script"></a> script</h4>
<p>scriptæ­¥éª¤ä¸­å¯ä»¥å¼•ç”¨script Pipelineè¯­å¥ï¼Œå¹¶åœ¨Declarative Pipelineä¸­æ‰§è¡Œã€‚å¯¹äºå¤§å¤šæ•°ç”¨ä¾‹ï¼Œscriptåœ¨Declarative Pipelineä¸­çš„æ­¥éª¤ä¸æ˜¯å¿…é¡»çš„ï¼Œä½†å®ƒå¯ä»¥æä¾›ä¸€ä¸ªæœ‰ç”¨çš„åŠ å¼ºã€‚</p>
<h5 id="æ ·ä¾‹-13"><a class="markdownIt-Anchor" href="#æ ·ä¾‹-13"></a> æ ·ä¾‹</h5>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Jenkinsfile (Declarative Pipeline)</span></span><br><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">&#x27;Example&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">&#x27;Hello World&#x27;</span></span><br><span class="line">                script &#123;</span><br><span class="line">                    <span class="keyword">def</span> browsers = [<span class="string">&#x27;chrome&#x27;</span>, <span class="string">&#x27;firefox&#x27;</span>]</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; browsers.size(); ++i) &#123;</span><br><span class="line">                        echo <span class="string">&quot;Testing the $&#123;browsers[i]&#125; browser&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-scripted-pipeline"><a class="markdownIt-Anchor" href="#3-scripted-pipeline"></a> 3 Scripted Pipeline</h2>
<p>Groovyè„šæœ¬ä¸ä¸€å®šé€‚åˆæ‰€æœ‰ä½¿ç”¨è€…ï¼Œå› æ­¤Jenkinsåˆ›å»ºäº†Declarative Pipelineï¼Œä¸ºç¼–å†™Jenkins Pipelineæä¾›äº†ä¸€ç§æ›´ç®€å•ã€æ›´æœ‰æ„ä¹‰çš„è¯­æ³•ã€‚ä½†æ˜¯ä¸å¯å¦è®¤ï¼Œç”±äºè„šæœ¬åŒ–çš„pipelineæ˜¯åŸºäºgroovyçš„ä¸€ç§DSLè¯­è¨€ï¼Œæ‰€ä»¥ä¸Declarative pipelineç›¸æ¯”ä¸ºJenkinsç”¨æˆ·æä¾›äº†æ›´å·¨å¤§çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€‚</p>
<h3 id="31-æµç¨‹æ§åˆ¶"><a class="markdownIt-Anchor" href="#31-æµç¨‹æ§åˆ¶"></a> 3.1 æµç¨‹æ§åˆ¶</h3>
<p>Pipelineè„šæœ¬åŒå…¶å®ƒè„šæœ¬è¯­è¨€ä¸€æ ·ï¼Œä»ä¸Šè‡³ä¸‹é¡ºåºæ‰§è¡Œï¼Œå®ƒçš„æµç¨‹æ§åˆ¶å–å†³äºGroovyè¡¨è¾¾å¼ï¼Œå¦‚if/elseæ¡ä»¶è¯­å¥ï¼Œä¸¾ä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Jenkinsfile (Scripted Pipeline)</span></span><br><span class="line">node &#123;</span><br><span class="line">    stage(<span class="string">&#x27;Example&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (env.BRANCH_NAME == <span class="string">&#x27;master&#x27;</span>) &#123;</span><br><span class="line">            echo <span class="string">&#x27;I only execute on the master branch&#x27;</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            echo <span class="string">&#x27;I execute elsewhere&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Pipelineè„šæœ¬æµç¨‹æ§åˆ¶çš„å¦ä¸€ç§æ–¹å¼æ˜¯Groovyçš„å¼‚å¸¸å¤„ç†æœºåˆ¶ã€‚å½“ä»»ä½•ä¸€ä¸ªæ­¥éª¤å› å„ç§åŸå› è€Œå‡ºç°å¼‚å¸¸æ—¶ï¼Œéƒ½å¿…é¡»åœ¨Groovyä¸­ä½¿ç”¨try/catch/finallyè¯­å¥å—è¿›è¡Œå¤„ç†ï¼Œä¸¾ä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Jenkinsfile (Scripted Pipeline)</span></span><br><span class="line">node &#123;</span><br><span class="line">    stage(<span class="string">&#x27;Example&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            sh <span class="string">&#x27;exit 1&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (exc) &#123;</span><br><span class="line">            echo <span class="string">&#x27;Something failed, I should sound the klaxons!&#x27;</span></span><br><span class="line">            <span class="keyword">throw</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="32-steps"><a class="markdownIt-Anchor" href="#32-steps"></a> 3.2 Steps</h3>
<p>å¦‚æœ¬ç« å¼€å§‹æ‰€è¨€ï¼Œpipelineæœ€æ ¸å¿ƒå’ŒåŸºæœ¬çš„éƒ¨åˆ†å°±æ˜¯â€œstepâ€ã€‚ä»æ ¹æœ¬ä¸Šæ¥è¯´ï¼Œstepsæ˜¯ä½œä¸ºDeclarative pipelineå’ŒScripted pipelineè¯­æ³•çš„æœ€åŸºæœ¬çš„è¯­å¥å—ï¼Œæ¥å‘Šè¯‰jenkinsåº”è¯¥æ‰§è¡Œä»€ä¹ˆæ“ä½œã€‚</p>
<p>Scripted pipelineä¸å†ä¸“é—¨å°†stepsä½œä¸ºå®ƒçš„è¯­æ³•çš„ä¸€éƒ¨åˆ†æ¥ä»‹ç»ï¼Œä½†æ˜¯åœ¨Pipeline Steps referenceè¿™ç¯‡æ–‡æ¡£ä¸­å¯¹pipelineåŠå…¶æ’ä»¶æ¶‰åŠçš„stepsåšäº†å¾ˆè¯¦ç»†çš„ä»‹ç»ã€‚å¦‚æœ‰éœ€è¦å¯å‚è€ƒJenkinså®˜ç½‘å¯¹è¯¥éƒ¨åˆ†çš„ä»‹ç»ã€‚</p>
<h3 id="33-ä¸æ™®é€šgroovyçš„åŒºåˆ«"><a class="markdownIt-Anchor" href="#33-ä¸æ™®é€šgroovyçš„åŒºåˆ«"></a> 3.3 ä¸æ™®é€šGroovyçš„åŒºåˆ«</h3>
<p>ç”±äºpipelineçš„ä¸€äº›ä¸ªæ€§åŒ–éœ€æ±‚ï¼Œæ¯”å¦‚åœ¨é‡æ–°å¯åŠ¨Jenkinsåè¦æ±‚pipelineè„šæœ¬ä»ç„¶å¯ä»¥è¿è¡Œï¼Œé‚£ä¹ˆpipelineè„šæœ¬å¿…é¡»å°†ç›¸å…³æ•°æ®åšåºåˆ—åŒ–ï¼Œç„¶è€Œè¿™ä¸€ç‚¹ Groovyå¹¶ä¸èƒ½å®Œç¾çš„æ”¯æŒã€‚</p>
<h3 id="34-declarative-pipelineå’Œscripted-pipelineçš„æ¯”è¾ƒ"><a class="markdownIt-Anchor" href="#34-declarative-pipelineå’Œscripted-pipelineçš„æ¯”è¾ƒ"></a> 3.4 Declarative Pipelineå’ŒScripted Pipelineçš„æ¯”è¾ƒ</h3>
<p>å…±åŒç‚¹ï¼š</p>
<p>ä¸¤è€…éƒ½æ˜¯pipelineä»£ç çš„æŒä¹…å®ç°ï¼Œéƒ½èƒ½å¤Ÿä½¿ç”¨pipelineå†…ç½®çš„æ’ä»¶æˆ–è€…æ’ä»¶æä¾›çš„stepsï¼Œä¸¤è€…éƒ½å¯ä»¥åˆ©ç”¨å…±äº«åº“æ‰©å±•ã€‚</p>
<p>åŒºåˆ«ï¼š</p>
<p>ä¸¤è€…ä¸åŒä¹‹å¤„åœ¨äºè¯­æ³•å’Œçµæ´»æ€§ã€‚Declarative Pipelineå¯¹ç”¨æˆ·æ¥è¯´ï¼Œè¯­æ³•æ›´ä¸¥æ ¼ï¼Œæœ‰å›ºå®šçš„ç»„ç»‡ç»“æ„ï¼Œæ›´å®¹æ˜“ç”Ÿæˆä»£ç æ®µï¼Œä½¿å…¶æˆä¸ºç”¨æˆ·æ›´ç†æƒ³çš„é€‰æ‹©ã€‚ä½†æ˜¯Scripted pipelineæ›´åŠ çµæ´»ï¼Œå› ä¸ºGroovyæœ¬èº«åªèƒ½å¯¹ç»“æ„å’Œè¯­æ³•è¿›è¡Œé™åˆ¶ï¼Œå¯¹äºæ›´å¤æ‚çš„pipelineæ¥è¯´ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡è¿›è¡Œçµæ´»çš„å®ç°å’Œæ‰©å±•ã€‚</p>
<h2 id="4-å°ç»“"><a class="markdownIt-Anchor" href="#4-å°ç»“"></a> 4 å°ç»“</h2>
<p>Pipelineè¯­æ³•æ˜¯ä½¿ç”¨Jenkins Pipelineçš„åŸºç¡€ï¼ŒJenkinsæä¾›äº†Declarative Pipelineå’ŒScripted Pipelineä¸¤ç§è¯­æ³•ç»“æ„ï¼Œè¿™ä¸¤è€…åœ¨åº•å±‚éƒ½æ˜¯åŸºäºç›¸åŒçš„Pipelineå­ç³»ç»Ÿï¼Œä¾ç…§&quot;Pipeline as code&quot;çš„ç†å¿µè¿›è¡Œå®ç°ã€‚</p>
<p>ç›¸å¯¹æ¥è¯´ï¼ŒDeclarative Pipelineè¯­æ³•æ›´ç®€æ´ä¹Ÿæ›´å®¹æ˜“ç†è§£ï¼Œè€Œä¸”å¯ä»¥ä¸BlueOceanç¼–è¾‘å™¨è¿›è¡Œå›¾å½¢åŒ–æ“ä½œç»“åˆï¼Œä¹Ÿæ˜¯Jenkinsç¤¾åŒºé¼“åŠ±ä½¿ç”¨çš„ä¸€ç§è¯­æ³•ç»“æ„ã€‚</p>
<p>åŸºäºä»¥ä¸ŠåŸå› ï¼Œ<code>åé¢æˆ‘ä»¬çš„äº¤ä»˜æµæ°´çº¿æ ·ä¾‹å‡é‡‡ç”¨ **Declarativeè¯­æ³•** ç»“æ„è¿›è¡Œç¼–å†™ã€‚</code></p>
<h2 id="5-å¼•ç”¨"><a class="markdownIt-Anchor" href="#5-å¼•ç”¨"></a> 5 å¼•ç”¨</h2>
<p><a href="https://jenkins.io/doc/book/pipeline/syntax/">Jenkins Pipeline è¯­æ³•å®˜æ–¹æ–‡æ¡£å‚è€ƒ</a></p>
]]></content>
      <categories>
        <category>Jenkins</category>
      </categories>
      <tags>
        <tag>Jenkins</tag>
      </tags>
  </entry>
  <entry>
    <title>Jenkinså…±äº«åº“</title>
    <url>/2021/06/08/Jenkins/Jenkins%E5%85%B1%E4%BA%AB%E5%BA%93/</url>
    <content><![CDATA[<h1 id="jenkinså…±äº«åº“ä½¿ç”¨è¯´æ˜"><a class="markdownIt-Anchor" href="#jenkinså…±äº«åº“ä½¿ç”¨è¯´æ˜"></a> Jenkinså…±äº«åº“ä½¿ç”¨è¯´æ˜</h1>
<p><strong><code>åœ¨Jenkin pipelinesè„šæœ¬ä¸­ï¼ŒæŠ½è±¡å‡ºä¸€äº›å…¬å…±çš„å‡½æ•°ç±»åº“ï¼Œé¿å…é¡¹ç›®æ–¹é‡å¤å†—ä½™çš„è„šæœ¬ä»£ç ä¹¦å†™</code></strong>ï¼Œåœ¨æ­¤å¤„æˆ‘ä¹ŸæŠŠæˆ‘ç»å¸¸ä½¿ç”¨çš„ä¸€äº›å…±äº«å‡½æ•°åº“ï¼ˆ<strong><a href="https://github.com/nengwu765/jenkins-share-library">jenkins-share-library</a></strong>ï¼‰åˆ†äº«å‡ºæ¥ï¼Œæ¬¢è¿äº¤æµæŒ‡æ­£å“ˆï¼</p>
<span id="more"></span>
<h2 id="1-å¦‚ä½•ä½¿ç”¨jenkinså…±äº«åº“"><a class="markdownIt-Anchor" href="#1-å¦‚ä½•ä½¿ç”¨jenkinså…±äº«åº“"></a> 1. å¦‚ä½•ä½¿ç”¨Jenkinså…±äº«åº“</h2>
<ul>
<li>åœ¨Jenkinsfileçš„è„šæœ¬æ–‡ä»¶ç¬¬ä¸€è¡Œå¼•å…¥ä»¥ä¸‹ä»£ç </li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">library &#x27;jenkins-shared-libraries&#x27;</span><br><span class="line"></span><br><span class="line">pipeline &#123; ... &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>è°ƒç”¨ç¤ºä¾‹</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">stage (&quot;demo&quot;) &#123;</span><br><span class="line">	steps &#123;</span><br><span class="line">		script &#123;</span><br><span class="line">			// è°ƒç”¨ï¼šå…±äº«æ–¹æ³•å+å…¥å‚</span><br><span class="line">			demoFunction(params1, params2, ...)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-æ”¯æŒçš„å…±äº«åº“æ–¹æ³•"><a class="markdownIt-Anchor" href="#2-æ”¯æŒçš„å…±äº«åº“æ–¹æ³•"></a> 2. æ”¯æŒçš„å…±äº«åº“æ–¹æ³•</h2>
<h3 id="21-gitä»“åº“æ‹‰å–-gitcodefetch"><a class="markdownIt-Anchor" href="#21-gitä»“åº“æ‹‰å–-gitcodefetch"></a> 2.1 Gitä»“åº“æ‹‰å– - gitCodeFetch()</h3>
<p>æ”¯æŒåŸºäºåˆ†æ”¯/æ ‡ç­¾ å’Œ Submoduleå­ä»“åº“æ‹‰å–ä»¥åŠåŸºäºMRæ‹‰å–åˆ†æ”¯ï¼Œ<a href="https://github.com/nengwu765/jenkins-share-library/blob/master/vars/gitCodeFetch.groovy">æºç å‚è€ƒ</a></p>
<ul>
<li>å…¥å‚è¯´æ˜</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Gitä»“åº“ç‰ˆæœ¬æ‹‰å– -- æ”¯æŒåŸºäºåˆ†æ”¯/æ ‡ç­¾ å’Œ Submoduleå­ä»“åº“æ‹‰å–ä»¥åŠåŸºäºMRæ‹‰å–åˆ†æ”¯</span><br><span class="line"> *</span><br><span class="line"> * @param fetchMode Gitä»£ç æ‹‰å–æ–¹å¼ï¼šbranch-åŸºäºåˆ†æ”¯; tag-åŸºäºæ ‡ç­¾</span><br><span class="line"> * @param gitBranchOrTag Gitä»“åº“åˆ†æ”¯ æˆ– æ ‡ç­¾</span><br><span class="line"> * @param gitRepository  Gitä»“åº“åœ°å€</span><br><span class="line"> * @param gitCredentialsId  Gitæ‹‰å–å‡­è¯ID ã€è‹¥å­˜åœ¨Submoduleå­ä»“åº“ï¼Œåˆ™è¯¥å‡­è¯éœ€è¦æœ‰å­ä»“åº“æ‹‰å–æƒé™ã€‘</span><br><span class="line"> * @param gitEvent  gitæ‹‰å–äº‹ä»¶,åŸºäºåˆ†æ”¯æˆ–Tagæ‹‰å–,åˆ™ç½®ç©º; MergeRequeståˆ™ä¸º:&quot;MR&quot;</span><br><span class="line"> * @param targetBranch è‹¥gitEventä¸º&quot;MR&quot;,æ­¤å¤„ä¸ºMRç›®æ ‡åˆ†æ”¯</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">void call(String fetchMode,String gitBranchOrTag, String gitRepository, String gitCredentialsId, String gitEvent = &#x27;&#x27;, String targetBranch = &#x27;&#x27;) </span><br></pre></td></tr></table></figure>
<h3 id="22-md5å€¼æ ¡éªŒ-md5check"><a class="markdownIt-Anchor" href="#22-md5å€¼æ ¡éªŒ-md5check"></a> 2.2 MD5å€¼æ ¡éªŒ - md5Check()</h3>
<p>æ–‡ä»¶MD5å€¼checkï¼Œ<a href="https://github.com/nengwu765/jenkins-share-library/blob/master/vars/md5Check.groovy">æºç å‚è€ƒ</a></p>
<ul>
<li>å…¥å‚è¯´æ˜</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * æ–‡ä»¶MD5å€¼check</span><br><span class="line"> *</span><br><span class="line"> * @param filePath æ–‡ä»¶è·¯å¾„</span><br><span class="line"> * @param md5 æ–‡ä»¶md5å€¼</span><br><span class="line"> * @param forceCheck æ˜¯å¼ºåˆ¶æ£€æŸ¥ï¼Œæ˜¯-å¿…æ£€ï¼Œå¦-md5å€¼éç©ºåˆ™è¿›è¡Œæ£€æŸ¥</span><br><span class="line"> */</span><br><span class="line">void md5Check(String filePath, String md5, boolean forceCheck = true)</span><br><span class="line"></span><br><span class="line">æ³¨ï¼šforceCheck=trueæ—¶ï¼Œæ ¡éªŒä¸é€šè¿‡åˆ™æŠ¥é”™ï¼Œæµæ°´çº¿ç»ˆæ­¢</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="23-sha1å€¼æ ¡éªŒ-sha1check"><a class="markdownIt-Anchor" href="#23-sha1å€¼æ ¡éªŒ-sha1check"></a> 2.3 SHA1å€¼æ ¡éªŒ - sha1Check()</h3>
<p>æ–‡ä»¶SHA1å€¼checkï¼Œ<a href="https://github.com/nengwu765/jenkins-share-library/blob/master/vars/sha1Check.groovy">æºç å‚è€ƒ</a></p>
<ul>
<li>å…¥å‚è¯´æ˜</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * æ–‡ä»¶SHA1å€¼check</span><br><span class="line"> *</span><br><span class="line"> * @param filePath æ–‡ä»¶è·¯å¾„</span><br><span class="line"> * @param sha1 æ–‡ä»¶md5å€¼</span><br><span class="line"> * @param forceCheck æ˜¯å¼ºåˆ¶æ£€æŸ¥ï¼Œæ˜¯-å¿…æ£€ï¼Œå¦-md5å€¼éç©ºåˆ™è¿›è¡Œæ£€æŸ¥</span><br><span class="line"> */</span><br><span class="line">void sha1Check(String filePath, String sha1, boolean forceCheck = true)</span><br><span class="line"></span><br><span class="line">æ³¨ï¼šforceCheck=trueæ—¶ï¼Œæ ¡éªŒä¸é€šè¿‡åˆ™æŠ¥é”™ï¼Œæµæ°´çº¿ç»ˆæ­¢</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="24-ftpä¸Šä¼ -ftpupload"><a class="markdownIt-Anchor" href="#24-ftpä¸Šä¼ -ftpupload"></a> 2.4 FTPä¸Šä¼  - ftpUpload()</h3>
<p>FTPæ–‡ä»¶ä¸Šä¼   â€“ // å‚æ•°å‚è€ƒè¯´æ˜ï¼š<a href="https://jenkins.io/doc/pipeline/steps/publish-over-ftp">https://jenkins.io/doc/pipeline/steps/publish-over-ftp</a></p>
<p><a href="https://github.com/nengwu765/jenkins-share-library/blob/master/vars/ftpUpload.groovy">æºç å‚è€ƒ</a></p>
<ul>
<li>å…¥å‚è¯´æ˜</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * FTPæ–‡ä»¶ä¸Šä¼   -- // å‚æ•°å‚è€ƒè¯´æ˜ï¼šhttps://jenkins.io/doc/pipeline/steps/publish-over-ftp</span><br><span class="line"> * @param configName  åœ¨Jenkinså…¨å±€è®¾ç½®çš„FTP Serveråç§°</span><br><span class="line"> * @param sourceFiles  ä¸Šä¼ æºæ–‡ä»¶ï¼Œæ”¯æŒæ­£åˆ™åŒ¹é…ï¼Œå¦‚[é€’å½’ç›®å½•å±‚çº§ä½¿ç”¨&#x27;**&#x27;]ï¼š&#x27;**/*.apk,public/**/*&#x27;</span><br><span class="line"> * @param remoteDir  ä¸Šä¼ å­ç›®å½•è·¯å¾„ï¼Œæ³¨æ­¤è·¯å¾„ä¼šè¿½åŠ åˆ°å…¨å±€è®¾ç½®çš„FTP Serverçš„Remote Directoryä¹‹å</span><br><span class="line"> * @param excludes  æ’é™¤ä¸Šä¼ æ–‡ä»¶ï¼Œæ”¯æŒæ­£åˆ™åŒ¹é…ï¼Œå¦‚[é€’å½’ç›®å½•å±‚çº§ä½¿ç”¨&#x27;**&#x27;]ï¼š &#x27;**/*.log,**/*.tmp,.git/&#x27;</span><br><span class="line"> * @param removePrefix  å»é™¤ä¸Šä¼ æ–‡ä»¶çš„è·¯å¾„å‰ç¼€ï¼Œé¿å…ftpæœåŠ¡å™¨ä¸­ç”Ÿæˆæ— ç”¨çš„ç›®å½•è·¯å¾„,æ³¨ï¼šæ‰€æœ‰ä¸Šä¼ æ–‡ä»¶å¿…é¡»éƒ½æœ‰è¯¥å‰ç¼€ï¼Œå¦åˆ™æŠ¥é”™</span><br><span class="line"> */</span><br><span class="line">void ftpUpload(String configName, String sourceFiles, String remoteDir = &#x27;&#x27;, String excludes = &#x27;&#x27;, String removePrefix = &#x27;&#x27;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="25-rsync-moduleè¿œç¨‹åŒæ­¥-rsyncmodule"><a class="markdownIt-Anchor" href="#25-rsync-moduleè¿œç¨‹åŒæ­¥-rsyncmodule"></a> 2.5 Rsync Moduleè¿œç¨‹åŒæ­¥ - rsyncModule()</h3>
<p>rsync ä½¿ç”¨Moduleè¿œç¨‹åŒæ­¥ï¼Œ<a href="https://github.com/nengwu765/jenkins-share-library/blob/master/vars/rsyncWithModule.groovy">æºç å‚è€ƒ</a></p>
<ul>
<li>å…¥å‚è¯´æ˜</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> *  rsync ä½¿ç”¨Moduleè¿œç¨‹åŒæ­¥</span><br><span class="line"> *</span><br><span class="line"> * @param ip rsyncæœåŠ¡å™¨IP</span><br><span class="line"> * @param port rsyncæœåŠ¡å™¨ç›‘å¬ç«¯å£</span><br><span class="line"> * @param path rsyncæœ¬åœ°åŒæ­¥ç»å¯¹è·¯å¾„</span><br><span class="line"> * @param module rsyncåŒæ­¥æ¨¡å—</span><br><span class="line"> * @param user  rsyncåŒæ­¥ç”¨æˆ·ï¼ŒæŒ‡å®šä¼ è¾“æ–‡ä»¶ä¸ºæŒ‡å®šç”¨æˆ·</span><br><span class="line"> * @param customParams å®šåˆ¶rsyncå‚æ•°ï¼Œä¸å…è®¸å‡ºç°&quot;delete&quot;å…³é”®å­—ï¼Œå¦‚ï¼š--exclude=PATTERN --include=PATTERN --exclude-from=FILE --include-from=FILE</span><br><span class="line"> * @param bwlimit</span><br><span class="line"> */</span><br><span class="line">void rsyncModule(String ip, int port, String path, String module, String user = &#x27;&#x27;, String customParams = &#x27;&#x27;, int bwlimit = 8192)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="26-åˆ¶å“ä¸Šä¼ nexus-uploadartifactstonexus"><a class="markdownIt-Anchor" href="#26-åˆ¶å“ä¸Šä¼ nexus-uploadartifactstonexus"></a> 2.6 åˆ¶å“ä¸Šä¼ Nexus - uploadArtifactsToNexus()</h3>
<p>å¦‚æœä½ æ˜¯ä»¥Nexusä½œä¸ºåˆ¶å“åº“çš„è¯ï¼Œè¿™ä¸ªå¯ä»¥ä½œä¸ºå‚è€ƒï¼Œ<a href="https://github.com/nengwu765/jenkins-share-library/blob/master/vars/uploadArtifactsToNexus.groovy">æºç å‚è€ƒ</a></p>
<ul>
<li>å…¥å‚è¯´æ˜</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * ä¸Šä¼ åˆ¶å“è‡³Nexusä»“åº“</span><br><span class="line"> *</span><br><span class="line"> * @param nexusRepository Nexusä¸Šä¼ ä»“åº“</span><br><span class="line"> * @param dir æ£€ç´¢ç›®å½•</span><br><span class="line"> * @param fileMatchRegex æ–‡ä»¶æ­£åˆ™åŒ¹é…è§„åˆ™ï¼Œ æ”¯æŒæ–‡ä»¶ç±»å‹ã€æ–‡ä»¶å‰ç¼€ã€æ–‡ä»¶å…¨åï¼Œ</span><br><span class="line"> *        å¦‚æ–‡ä»¶ï¼šprefix_file.test,</span><br><span class="line"> *        åŒ¹é…è§„åˆ™ï¼š</span><br><span class="line"> *              æ–‡ä»¶ç±»å‹ï¼š fileMatchRegex = &quot;.test&quot;</span><br><span class="line"> *              æ–‡ä»¶å‰ç¼€ï¼š fileMatchRegex = &quot;prefix_&quot;</span><br><span class="line"> *              æ–‡ä»¶å…¨åï¼š fileMatchRegex = &quot;prefix_file.test&quot;</span><br><span class="line"> * @param uploadSubPath åˆ¶å“ä¸Šä¼ è·¯ç»</span><br><span class="line"> * @param isRecursion æ˜¯å¦é€’å½’æ£€ç´¢å­ç›®å½•,é»˜è®¤ï¼šå¦ã€æ³¨ï¼šåŒåæ–‡ä»¶ä¼šè¢«è¦†ç›–ã€‘</span><br><span class="line"> * @param artifacts åˆ¶å“å­˜å‚¨æ•°æ®ï¼ŒMapç»“æ„ï¼Œé»˜è®¤ï¼šç©ºMap</span><br><span class="line"> * @return Map è¿”å›ä¸Šä¼ åˆ¶å“æ•°æ®</span><br><span class="line"> *         eg: [</span><br><span class="line"> *              &#x27;file1&#x27;:[</span><br><span class="line"> *                  &#x27;url&#x27;:&#x27;https://nexus.demo.com/.../file1&#x27;  // æ–‡ä»¶åœ¨nexusä¸­çš„ä¸Šä¼ è·¯å¾„ã€å³ä¸‹è½½è·¯å¾„ã€‘</span><br><span class="line"> *                  &#x27;md5&#x27;:&#x27;xxxx&#x27; // æ–‡ä»¶md5å€¼</span><br><span class="line"> *                  &#x27;sha1&#x27;:&#x27;xxxx&#x27;   // æ–‡ä»¶sha1å€¼</span><br><span class="line"> *               ],</span><br><span class="line"> *         ]</span><br><span class="line"> */</span><br><span class="line">def uploadArtifactsToNexus(String nexusRepository, String dir, String fileMatchRegex, String uploadPath, boolean isRecursion = false, Map artifacts = [:])</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>Androidåˆ¶å“ä¸Šä¼ Nexus - uploadAndroidArtifacts()</li>
</ul>
<p><strong><code>é’ˆå¯¹Androidåˆ¶å“ä¸Šä¼ ï¼Œåšäº†ä¸€å±‚å¤–å›´å°è£…ï¼Œé˜²æ­¢ä¸åŒä¸šåŠ¡ä¸Šä¼ ä»“åº“ç´Šä¹±</code></strong>ï¼Œ<a href="https://github.com/nengwu765/jenkins-share-library/blob/master/vars/uploadAndroidArtifacts.groovy">æºç å‚è€ƒ</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * ä¸Šä¼ åˆ¶å“è‡³Nexusä»“åº“</span><br><span class="line"> *</span><br><span class="line"> * @param dir æ£€ç´¢ç›®å½•</span><br><span class="line"> * @param fileMatchRegex æ–‡ä»¶æ­£åˆ™åŒ¹é…è§„åˆ™ï¼Œ æ”¯æŒæ–‡ä»¶ç±»å‹ã€æ–‡ä»¶å‰ç¼€ã€æ–‡ä»¶å…¨åï¼Œ</span><br><span class="line"> *        å¦‚æ–‡ä»¶ï¼šprefix_file.test,</span><br><span class="line"> *        åŒ¹é…è§„åˆ™ï¼š</span><br><span class="line"> *              æ–‡ä»¶ç±»å‹ï¼š fileMatchRegex = &quot;.test&quot;</span><br><span class="line"> *              æ–‡ä»¶å‰ç¼€ï¼š fileMatchRegex = &quot;prefix_&quot;</span><br><span class="line"> *              æ–‡ä»¶å…¨åï¼š fileMatchRegex = &quot;prefix_file.test&quot;</span><br><span class="line"> * @param uploadSubPath åˆ¶å“ä¸Šä¼ è·¯ç»</span><br><span class="line"> * @param isRecursion æ˜¯å¦é€’å½’æ£€ç´¢å­ç›®å½•,é»˜è®¤ï¼šå¦ã€æ³¨ï¼šåŒåæ–‡ä»¶ä¼šè¢«è¦†ç›–ã€‘</span><br><span class="line"> * @param artifacts åˆ¶å“å­˜å‚¨æ•°æ®ï¼ŒMapç»“æ„ï¼Œé»˜è®¤ï¼šç©ºMap</span><br><span class="line"> * @return Map è¿”å›ä¸Šä¼ åˆ¶å“æ•°æ®</span><br><span class="line"> *         eg: [</span><br><span class="line"> *              &#x27;file1&#x27;:[</span><br><span class="line"> *                  &#x27;url&#x27;:&#x27;https://nexus.demo.com/.../file1&#x27;  // æ–‡ä»¶åœ¨nexusä¸­çš„ä¸Šä¼ è·¯å¾„ã€å³ä¸‹è½½è·¯å¾„ã€‘</span><br><span class="line"> *                  &#x27;md5&#x27;:&#x27;xxxx&#x27; // æ–‡ä»¶md5å€¼</span><br><span class="line"> *                  &#x27;sha1&#x27;:&#x27;xxxx&#x27;   // æ–‡ä»¶sha1å€¼</span><br><span class="line"> *               ],</span><br><span class="line"> *         ]</span><br><span class="line"> */</span><br><span class="line">def uploadAndroidArtifacts(String dir, String fileMatchRegex, String uploadPath, boolean isRecursion = false, Map artifacts = [:])</span><br></pre></td></tr></table></figure>
<h3 id="27-æµæ°´çº¿ç»“æœå›è°ƒ-callbackaction"><a class="markdownIt-Anchor" href="#27-æµæ°´çº¿ç»“æœå›è°ƒ-callbackaction"></a> 2.7 æµæ°´çº¿ç»“æœå›è°ƒ - callBackAction()</h3>
<p>Jenkins pipelineç»“æœå›è°ƒé€šçŸ¥ï¼ˆè¿™ä¸ªå…¶å®æœ‰ä¸ªPluginæ”¯æŒï¼ŒJob Notificationï¼Œä½†æ˜¯æˆ‘è§‰å¾—ä¸å¤Ÿçµæ´»ï¼‰ï¼Œè¿™è¾¹æˆ‘è‡ªå®šä¹‰äº†ä¸€ä¸ªé€šç”¨å›è°ƒï¼Œå¯ä»¥é˜²æ­¢åœ¨ä»»ä½•ä½ç½®ï¼Œ<a href="https://github.com/nengwu765/jenkins-share-library/blob/master/vars/callBackAction.groovy">æºç å‚è€ƒ</a></p>
<ul>
<li>å…¥å‚è¯´æ˜</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * æµæ°´çº¿æ‰§è¡Œç»“æœå›è°ƒæ“ä½œ</span><br><span class="line"> *</span><br><span class="line"> * @param callBackUrlsJson å›è°ƒUrlåœ°å€Jsonæ•°æ®</span><br><span class="line"> * @param artifacts åˆ¶å“å­˜å‚¨æ•°æ®</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">void callBackAction(String callBackUrlsJson, Map artifacts = [:])</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>ä½¿ç”¨ç¤ºä¾‹</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">	agent any</span><br><span class="line"></span><br><span class="line">	stages &#123;...&#125;</span><br><span class="line">    </span><br><span class="line">	post &#123;</span><br><span class="line">        always &#123;</span><br><span class="line">            // å›è°ƒApié€šçŸ¥å¯¹æ¥JOBæ‰§è¡Œç»“æœ</span><br><span class="line">            script &#123;</span><br><span class="line">                if (!binding.variables.containsKey(&quot;ARTIFACTS&quot;)) &#123;</span><br><span class="line">                    ARTIFACTS = [:]</span><br><span class="line">                &#125;</span><br><span class="line">                callBackAction(params.CALLBACK_URLS_JSON, ARTIFACTS)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            echo &quot;I will be executed while failed or succeed&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="5-å¼•ç”¨"><a class="markdownIt-Anchor" href="#5-å¼•ç”¨"></a> 5 å¼•ç”¨</h2>
<p><a href="https://www.jenkins.io/doc/book/pipeline/shared-libraries/">å®˜æ–¹å‚è€ƒï¼ŒExtending with Shared Libraries</a></p>
]]></content>
      <categories>
        <category>Jenkins</category>
      </categories>
      <tags>
        <tag>Jenkins</tag>
      </tags>
  </entry>
</search>
